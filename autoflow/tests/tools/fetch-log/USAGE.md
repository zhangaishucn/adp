# æ—¥å¿—æ”¶é›†å·¥å…·ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä¸º data-agent æœåŠ¡è®¾è®¡çš„ Kubernetes æ—¥å¿—è‡ªåŠ¨æ”¶é›†å·¥å…·ã€‚è¯¥å·¥å…·èƒ½å¤Ÿä» K8s é›†ç¾¤ä¸­è‡ªåŠ¨æ”¶é›†æŒ‡å®šæœåŠ¡çš„æ—¥å¿—ï¼Œå¹¶è¾“å‡ºä¸ºç»“æ„åŒ–çš„ JSON æ ¼å¼ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… è‡ªåŠ¨å‘ç°æŒ‡å®šæœåŠ¡çš„æ‰€æœ‰ Pods
- âœ… æ”¯æŒæ”¶é›†æ§åˆ¶å°æ—¥å¿—ï¼ˆé»˜è®¤æœ€è¿‘ 300 è¡Œï¼‰
- âœ… å¯¹ agent-executor æœåŠ¡ç‰¹æ®Šå¤„ç†ï¼ŒåŒæ—¶æ”¶é›†æ§åˆ¶å°å’Œå®¹å™¨å†…æ—¥å¿—æ–‡ä»¶
- âœ… è¾“å‡ºä¸ºæ ‡å‡† JSON æ ¼å¼ï¼Œä¾¿äºåç»­å¤„ç†å’Œåˆ†æ
- âœ… æ”¯æŒå‘½ä»¤è¡Œå‚æ•°è‡ªå®šä¹‰æœåŠ¡åˆ—è¡¨
- âœ… è·¨å¹³å°æ”¯æŒï¼ˆLinux AMD64 å’Œ ARM64ï¼‰

## ç¯å¢ƒè¦æ±‚

1. **Kubernetes é›†ç¾¤è®¿é—®**
   - kubectl å·²å®‰è£…å¹¶é…ç½®
   - å…·æœ‰è¯»å– pods å’Œæ—¥å¿—çš„æƒé™

   - æ— éœ€é¢å¤–ä¾èµ–åŒ…

3. **Go ç¯å¢ƒ**ï¼ˆç”¨äºç¼–è¯‘ç”Ÿäº§ç‰ˆæœ¬ï¼‰
   - Go 1.21 æˆ–æ›´é«˜ç‰ˆæœ¬

## å¿«é€Ÿå¼€å§‹


```bash
# è¿›å…¥å·¥å…·ç›®å½•
cd tools/fetch-log

# ä½¿ç”¨é»˜è®¤æœåŠ¡ï¼ˆagent-app, agent-executorï¼‰

# æŒ‡å®šè‡ªå®šä¹‰æœåŠ¡åˆ—è¡¨
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ Go ç‰ˆæœ¬ï¼ˆéœ€è¦ç¼–è¯‘ï¼‰

```bash
# ç¼–è¯‘ï¼ˆéœ€è¦ Go ç¯å¢ƒï¼‰
cd tools/fetch-log
make build

# è¿è¡Œ
./build/fetch_log

# æŒ‡å®šæœåŠ¡åˆ—è¡¨
./build/fetch_log --svc_list "agent-factory,agent-memory"
```

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæ”¶é›† agent-app å’Œ agent-executor çš„æ—¥å¿—

```bash
```

è¾“å‡ºï¼š
```
ğŸ“‹ Starting log collection for services: ['agent-app', 'agent-executor']

ğŸ” Processing service: agent-app
Found 1 pod(s) for service agent-app
âœ“ Collected logs from pod: agent-app-6dd858f8f8-fzk79

ğŸ” Processing service: agent-executor
Found 1 pod(s) for service agent-executor
âœ“ Collected logs from pod: agent-executor-575b7bf4bc-8xc7r

âœ… Log collection completed. Output saved to: log_20260108_103901.json
ğŸ“Š Total entries collected: 2
```

### ç¤ºä¾‹ 2ï¼šæ”¶é›†ç‰¹å®šæœåŠ¡çš„æ—¥å¿—

```bash
```

### ç¤ºä¾‹ 3ï¼šæ”¶é›†å¤šä¸ªæœåŠ¡çš„æ—¥å¿—

```bash
```

## è¾“å‡ºæ ¼å¼

å·¥å…·ä¼šç”Ÿæˆåä¸º `log_<æ—¶é—´æˆ³>.json` çš„æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ç»“æ„ï¼š

```json
[
  {
    "svc_name": "agent-app",
    "pod": "agent-app-6dd858f8f8-fzk79",
    "fetch_time": "2026-01-08 10:38:59",
    "fecth_log_lines": 300,
    "log_detail": "æ—¥å¿—è¯¦ç»†å†…å®¹..."
  },
  {
    "svc_name": "agent-executor",
    "pod": "agent-executor-575b7bf4bc-8xc7r",
    "fetch_time": "2026-01-08 10:39:01",
    "fecth_log_lines": 300,
    "log_detail": "=== Console Logs ===\næ§åˆ¶å°æ—¥å¿—\n\n=== Container File Logs ===\n=== agent-executor.log ===\næ–‡ä»¶æ—¥å¿—\n\n=== dolphin.log ===\næ–‡ä»¶æ—¥å¿—\n\n=== request.log ===\næ–‡ä»¶æ—¥å¿—"
  }
]
```

## agent-executor ç‰¹æ®Šå¤„ç†

å¯¹äº `agent-executor` æœåŠ¡ï¼Œå·¥å…·ä¼šé¢å¤–æ”¶é›†å®¹å™¨å†…çš„æ—¥å¿—æ–‡ä»¶ï¼š

1. **æ§åˆ¶å°æ—¥å¿—**ï¼šé€šè¿‡ `kubectl logs` è·å–
2. **å®¹å™¨æ–‡ä»¶æ—¥å¿—**ï¼š
   - `log/agent-executor.log` - agent-executor ä¸»æ—¥å¿—
   - `log/dolphin.log` - dolphin å¼•æ“æ—¥å¿—
   - `log/request.log` - è¯·æ±‚æ—¥å¿—

## å¸¸è§é—®é¢˜

### Q1: æç¤º "No pods found for service"

**åŸå› **ï¼šK8s é›†ç¾¤ä¸­æ²¡æœ‰åŒ¹é…çš„ Pod

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æœåŠ¡åæ˜¯å¦æ­£ç¡®
2. è¿è¡Œ `kubectl get pods -A | grep <æœåŠ¡å>` ç¡®è®¤ Pod æ˜¯å¦å­˜åœ¨
3. æ£€æŸ¥ kubectl é…ç½®æ˜¯å¦æ­£ç¡®

### Q2: æç¤ºæƒé™é”™è¯¯

**åŸå› **ï¼šå½“å‰ç”¨æˆ·æ²¡æœ‰è¯»å– Pod æ—¥å¿—çš„æƒé™

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ kubeconfig é…ç½®æ­£ç¡®
2. è”ç³»ç®¡ç†å‘˜æˆäºˆå¿…è¦çš„ RBAC æƒé™
3. éœ€è¦çš„æƒé™ï¼š`pods/log`, `pods/get`

### Q3: æ—¥å¿—æ–‡ä»¶å¤ªå¤§

**åŸå› **ï¼šé»˜è®¤æ”¶é›† 300 è¡Œæ—¥å¿—ï¼Œå¯¹äºé«˜é¢‘æœåŠ¡å¯èƒ½è¾ƒå¤§

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä¿®æ”¹æºä»£ç ä¸­çš„ `DEFAULT_LOG_LINES` å¸¸é‡
2. æˆ–è€…æ‰‹åŠ¨ç¼–è¾‘ç”Ÿæˆåçš„ JSON æ–‡ä»¶

### Q4: å¦‚ä½•åªæ”¶é›†æ§åˆ¶å°æ—¥å¿—è€Œä¸æ”¶é›†å®¹å™¨æ–‡ä»¶æ—¥å¿—

**åŸå› **ï¼šagent-executor é»˜è®¤ä¼šæ”¶é›†æ‰€æœ‰æ—¥å¿—

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®æ”¹æºä»£ç ï¼Œæ³¨é‡Šæ‰å®¹å™¨æ–‡ä»¶æ—¥å¿—æ”¶é›†éƒ¨åˆ†
- æˆ–è€…ä»…å¯¹é agent-executor æœåŠ¡ä½¿ç”¨è¯¥å·¥å…·

## é«˜çº§ä½¿ç”¨

### äº¤å‰ç¼–è¯‘ï¼ˆGo ç‰ˆæœ¬ï¼‰

```bash
# ç¼–è¯‘æ‰€æœ‰å¹³å°ç‰ˆæœ¬
make build-all

# ç¼–è¯‘ç‰¹å®šå¹³å°
make build-linux-amd64   # Linux x86_64
make build-linux-arm64   # Linux ARM64
```

### æ¸…ç†ç”Ÿæˆçš„æ–‡ä»¶

```bash
# æ¸…ç†ç¼–è¯‘äº§ç‰©å’Œæ—¥å¿—æ–‡ä»¶
make clean
```

### æŸ¥çœ‹å¸®åŠ©

```bash
```

## æ–‡ä»¶è¯´æ˜

```
tools/fetch-log/
â”œâ”€â”€ main.go           # Go è¯­è¨€å®ç°
â”œâ”€â”€ go.mod           # Go æ¨¡å—é…ç½®
â”œâ”€â”€ Makefile         # ç¼–è¯‘é…ç½®
â”œâ”€â”€ README.md        # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ USAGE.md         # æœ¬ä½¿ç”¨æŒ‡å—
â””â”€â”€ log_*.json       # ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶
```

## æ”¯æŒçš„æœåŠ¡

è¯¥å·¥å…·ä¸ä»…é™äº data-agent ç›¸å…³æœåŠ¡ï¼Œå¯ä»¥æ”¶é›†ä»»ä½• K8s æœåŠ¡çš„æ—¥å¿—ï¼š

- **data-agent æœåŠ¡**ï¼šagent-app, agent-executor, agent-factory
- **data-operator-hub æœåŠ¡**ï¼šoperator-hub, operator-hub-internal
- **å…¶ä»–æœåŠ¡**ï¼šä»»ä½•å¯ä»¥é€šè¿‡ kubectl è·å–çš„æœåŠ¡

## è´¡çŒ®ä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³» data-agent ç ”å‘å›¢é˜Ÿã€‚

## æ›´æ–°æ—¥å¿—

- **2025-01-08**: åˆå§‹ç‰ˆæœ¬
  - æ”¯æŒè‡ªå®šä¹‰æœåŠ¡åˆ—è¡¨
  - agent-executor ç‰¹æ®Šå¤„ç†
  - è·¨å¹³å°ç¼–è¯‘æ”¯æŒ
