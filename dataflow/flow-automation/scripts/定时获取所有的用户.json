{"title":"定时获取所有的用户202404101956","description":"","steps":[{"id":"0","title":"","operator":"@trigger/cron","dataSource":{"id":"2","operator":"@anyshare-data/user","parameters":{"accessorid":"00000000-0000-0000-0000-000000000000"}},"cron":"0 30 0 * * ?"},{"id":"1","title":"","operator":"@internal/tool/py3","parameters":{"code":"import re\nimport requests\nfrom aishu_anyshare_api.api_client import ApiClient\n\ndef main(name, id):\n    pattern = re.compile(r'([^\\（]+)\\（([^）]+)\\）')\n    match = pattern.search(name)\n    chinese_name = name\n    english_name = ''\n    dep = ''\n    if match:\n        chinese_name = match.group(1)\n        english_name = match.group(2)\n\n    try:\n        url = \"{}/api/kc-mc/v2/user-card-info?user_id={}\".format(ApiClient.get_global_host(), id)\n        headers = {'Content-Type': 'application/json','Authorization': 'Bearer {}'.format(ApiClient.get_global_access_token())}\n        resp = requests.request(method=\"GET\", url= url, headers=headers, verify=False)\n        _json = resp.json()\n        _dep = _json[\"data\"]['out_dep']\n        dep = ';'.join(_dep)\n    except:\n        return chinese_name, english_name, dep\n        \n    return chinese_name, english_name, dep","input_params":[{"id":"bgknp","key":"name","type":"string","value":"{{__0.name}}"},{"id":"ttt","key":"id","type":"string","value":"{{__2.id}}"}],"output_params":[{"id":"w3dty","key":"chinese_name","type":"string"},{"id":"rfq4v","key":"english_name","type":"string"},{"id":"rrttt","key":"parent_depth","type":"string"}]}},{"id":"3","title":"","operator":"@intelliinfo/transfer","parameters":{"data":{"contact":"{{__2.contact}}","csflevel":"{{__2.csflevel}}","email":"{{__2.email}}","english_name":"{{__1.english_name}}","id":"{{__2.id}}","is_expert":"{{__2.is_expert}}","name":"{{__1.chinese_name}}","parent":"{{__1.parent_depth}}","parent_ids":"{{__2.parent_ids}}","position":"{{__2.position}}","professional":"{{__2.professional}}","role":"{{__2.role}}","status":"{{__2.status}}","tags":"{{__2.tags}}","university":"{{__2.university}}","verification_info":"{{__2.verification_info}}","work_at":"{{__2.work_at}}"},"rule_id":"person_upsert"}}],"status":"normal"}