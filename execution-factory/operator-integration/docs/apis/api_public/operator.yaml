openapi: "3.0.2"
info:
  title: "DIP算子服务公有接口协议"
  version: "1.0.0"
  description: "DIP算子服务公有接口协议RESTful API集合,用于集群外部服务调用, 需接口认证信息"
servers:
  - url: "http://{host}:{port}/api/agent-operator-integration/v1"
    description: "DIP算子服务公有接口协议接口地址"
    variables:
      host:
        default: "agent-operator-integration"
        description: "agent-operator-integration, 地址默认为agent-operator-integration 命名空间为 anyshare"
      port:
        default: "9000"
        description: "默认端口9000"

paths:
  /operator/register:
    post:
      summary: "注册算子"
      description: "注册算子"
      tags:
        - "算子管理"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
        - name: x-business-domain
          in: header
          required: true
          schema:
            type: string
          description: 业务域ID
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OperatorRegisterReq"
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperatorRegisterResp"
        "403":
          description: "无权限"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "409":
          description: "算子已存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/info/update:
    post:
      summary: "更新算子信息"
      description: "更新算子信息"
      tags:
        - "算子管理"
      requestBody:
        content:
          application/json:
            schema:
              required:
                - operator_id
              allOf:
                - properties:
                    operator_id:
                      type: string
                      description: "算子ID"
                - $ref: "#/components/schemas/OperatorRegisterReq"
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperatorRegisterResp"
        "403":
          description: "无权限"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "409":
          description: "算子已存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/info/list:
    get:
      summary: "获取算子列表"
      description: "获取算子列表"
      tags:
        - "算子管理"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
        - name: x-business-domain
          in: header
          required: true
          schema:
            type: string
          description: 业务域ID
        - name: page
          in: query
          description: "页码，从1开始，默认为1"
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: page_size
          in: query
          description: "每页数量，默认为10，最大为100，当page_size为-1时，返回所有算子信息"
          required: false
          schema:
            type: integer
            default: 10
            maximum: 100
        - name: sort_by
          in: query
          description: "排序字段，支持按创建时间、更新时间、名称排序"
          schema:
            type: string
            enum:
              - "create_time" # 创建时间
              - "update_time" # 更新时间
              - "name" # 算子名称
            default: "update_time"
        - name: sort_order
          in: query
          description: "排序规则"
          schema:
            type: string
            enum:
              - "asc" # 升序
              - "desc" # 降序
            default: "desc"
        - name: create_user
          in: query
          description: "根据创建用户查询,默认根据更新时间排序，desc"
          schema:
            type: string
        - name: name
          in: query
          description: "根据算子名称查询，返回所有版本的算子信息，默认根据更新时间排序，desc"
          schema:
            type: string
        - name: status
          in: query
          description: "根据算子状态查询，返回所有版本的算子信息，默认根据更新时间排序，desc"
          schema:
            type: string
            enum:
              - "unpublish"
              - "published"
              - "offline"
              - "editing"
        - name: category
          in: query
          description: "根据算子分类查询，返回所有版本的算子信息"
          schema:
            type: string
            default: "other_category"
            enum:
              - "other_category" # 自定义
              - "data_process" # 数据处理
              - "data_transform" # 数据转换
              - "data_store" # 数据存储
              - "data_analysis" # 数据分析
              - "data_query" # 数据查询
              - "data_extract" # 数据抽取
              - "data_split" # 数据分割
              - "model_train" # 模型训练
        - name: operator_type
          in: query
          description: "根据算子类型查询，返回所有版本的算子信息"
          schema:
            type: string
            enum:
              - "basic" # 基础算子
              - "composite" # 组合算子
        - name: all
          in: query
          description: "是否返回所有版本的算子信息，默认为false"
          schema:
            type: boolean
            default: false
        - name: is_data_source
          in: query
          description: "是否为数据源算子"
          schema:
            type: boolean
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperatorDataInfoList"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/info/{operator_id}:
    get:
      summary: "获取算子信息"
      description: "获取算子信息"
      tags:
        - "算子管理"
      parameters:
        - name: operator_id
          in: path
          description: "算子ID"
          required: true
          schema:
            type: string
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperatorDataInfo"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/info:
    post:
      summary: 编辑算子
      description: 编辑指定算子的信息
      tags:
        - "算子管理"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OperatorEditReq"
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/OperatorEditReq"
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/OperatorStatusItem"
                  - properties:
                      version:
                        type: string
                        description: 算子版本
        "400":
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: 算子不存在
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: 内部错误
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/category:
    get:
      summary: "获取算子分类"
      description: "获取算子分类列表"
      tags:
        - "分类管理"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    category_type:
                      type: string
                      description: "分类类型"
                      enum:
                        - "other_category" # 自定义
                        - "data_process" # 数据处理
                        - "data_transform" # 数据转换
                        - "data_store" # 数据存储
                        - "data_analysis" # 数据分析
                        - "data_query" # 数据查询
                        - "data_extract" # 数据抽取
                        - "data_split" # 数据分割
                        - "model_train" # 模型训练
                    name:
                      type: string
                      description: "分类名称，支持国际化"
        "404":
          description: "资源不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/delete:
    delete:
      summary: "删除算子"
      description: "删除指定的算子"
      tags:
        - "算子管理"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
        - name: x-business-domain
          in: header
          required: true
          schema:
            type: string
          description: 业务域ID
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OperatorDeleteReq"
      responses:
        "200":
          description: "删除成功"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部服务器错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/status:
    post:
      summary: "更新算子状态"
      description: "更新指定算子的状态"
      tags:
        - "算子管理"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OperatorStatusUpdateReq"
      responses:
        "200":
          description: "状态更新成功"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "409":
          description: "状态转换冲突"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部服务器错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/debug:
    post:
      summary: "调试算子"
      description: "调试指定算子"
      tags:
        - "算子管理"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
            example: "Bearer <token>"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OperatorDebugReq"
      responses:
        "200":
          description: "调试成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperatorDebugResp"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部服务器错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/history/:operator_id/:version:
    get:
      summary: "获取算子历史版本详情"
      description: "获取指定算子的历史版本"
      tags:
        - "算子历史"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
        - name: operator_id
          in: path
          description: "算子ID"
          required: true
          schema:
            type: string
        - name: version
          in: path
          description: "版本号"
          required: true
          schema:
            type: string
        - name: tag
          in: query
          description: "语义版本号，默认为最新"
          schema:
            type: integer
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperatorDataInfo"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部服务器错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/history/:operator_id:
    get:
      summary: "获取算子历史版本列表"
      description: "获取算子的历史版本列表"
      tags:
        - "算子历史"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
        - name: operator_id
          in: path
          description: "算子ID"
          required: true
          schema:
            type: string
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OperatorDataInfo"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部服务器错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/market:
    get:
      summary: "获取算子市场列表"
      description: "获取算子市场列表"
      tags:
        - "算子市场"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
        - name: x-business-domain
          in: header
          required: true
          schema:
            type: string
          description: 业务域ID
        - name: page
          in: query
          description: "页码，从1开始，默认为1"
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: page_size
          in: query
          description: "每页数量，默认为10，最大为100，当page_size为-1时，返回所有算子信息"
          required: false
          schema:
            type: integer
            default: 10
            maximum: 100
        - name: sort_by
          in: query
          description: "排序字段，支持按创建时间、更新时间、名称排序"
          schema:
            type: string
            enum:
              - "create_time" # 创建时间
              - "update_time" # 更新时间
              - "name" # 算子名称
            default: "update_time"
        - name: sort_order
          in: query
          description: "排序规则"
          schema:
            type: string
            enum:
              - "asc" # 升序
              - "desc" # 降序
            default: "desc"
        - name: create_user
          in: query
          description: "根据创建用户查询,默认根据更新时间排序，desc"
          schema:
            type: string
        - name: name
          in: query
          description: "根据算子名称查询，返回所有版本的算子信息，默认根据更新时间排序，desc"
          schema:
            type: string
        - name: status
          in: query
          description: "根据算子状态查询，返回所有版本的算子信息，默认根据更新时间排序，desc"
          schema:
            type: string
            enum:
              - "unpublish"
              - "published"
              - "offline"
              - "editing"
        - name: category
          in: query
          description: "根据算子分类查询，返回所有版本的算子信息"
          schema:
            type: string
            default: "other_category"
        - name: operator_type
          in: query
          description: "根据算子类型查询，返回所有版本的算子信息"
          schema:
            type: string
            enum:
              - "basic" # 基础算子
              - "composite" # 组合算子
        - name: release_user
          in: query
          description: "根据发布用户查询，返回所有版本的算子信息，默认根据更新时间排序，desc"
          schema:
            type: string
        - name: all
          in: query
          description: "是否返回所有版本的算子信息，默认为false"
          schema:
            type: boolean
            default: false
        - name: is_data_source
          in: query
          description: "是否为数据源算子"
          schema:
            type: boolean
        - name: execution_mode
          in: query
          description: "根据执行模式查询，返回所有版本的算子信息"
          schema:
            type: string
            enum:
              - "sync"
              - "async"
        - name: metadata_type
          in: query
          description: "根据元数据类型查询，返回所有版本的算子信息"
          schema:
            type: string
            enum:
              - "openapi"
              - "function"
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperatorDataInfoList"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/market/:operator_id:
    get:
      summary: "获取算子市场指定算子详情"
      description: "获取算子市场指定算子详情"
      tags:
        - "算子市场"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
        - name: operator_id
          in: path
          description: "算子ID"
          required: true
          schema:
            type: string
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperatorDataInfo"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /operator/intcomp:
    post:
      summary: "内置算子注册更新"
      description: "内置算子注册更新"
      tags:
        - "内置算子"
      parameters:
        - name: Authorization
          in: header
          description: "Bearer token"
          required: true
          schema:
            type: string
        - name: x-business-domain
          in: header
          required: true
          schema:
            type: string
          description: 业务域ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OperatorIntCompReq"
      responses:
        "200":
          description: "成功"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperatorIntCompResp"
        "400":
          description: "参数错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: "算子不存在"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: "内部错误"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    Error:
      type: object
      description: "错误信息"
      properties:
        code:
          type: string
          description: "错误码"
        description:
          type: string
          description: "错误信息"
        detail:
          type: object
          description: "错误详情"
        solution:
          type: string
          description: "错误解决方案"
        link:
          type: string
          description: "错误链接"
    OperatorDataInfoList:
      type: object
      description: "算子信息列表"
      properties:
        total:
          type: integer
          description: "总记录数"
        page:
          type: integer
          description: "当前页码"
        page_size:
          type: integer
          description: "每页记录数"
        total_pages:
          type: integer
          description: "总页数"
        has_next:
          type: boolean
          description: "是否有下一页"
        has_prev:
          type: boolean
          description: "是否有上一页"
        data:
          type: array
          items:
            $ref: "#/components/schemas/OperatorDataInfo"
    APISpec:
      type: object
      description: "API Spec 信息"
      properties:
        parameters:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: "参数名称"
              in:
                type: string
                description: "参数位置，如path/query/header/cookie"
              description:
                type: string
                description: "参数描述"
              required:
                type: boolean
                default: false
              schema:
                $ref: "#/components/schemas/ParameterSchema"
        request_body:
          type: object
          properties:
            description:
              type: string
              description: "请求体描述"
            required:
              type: boolean
              default: false
            content:
              type: object
              additionalProperties:
                type: object
                properties:
                  schema:
                    $ref: "#/components/schemas/ExampleRequest"
                  example:
                    $ref: "#/components/schemas/ExampleRequest"
        responses:
          type: object
          additionalProperties:
            type: object
            properties:
              description:
                type: string
                description: "响应描述"
              content:
                type: object
                additionalProperties:
                  type: object
                  properties:
                    schema:
                      $ref: "#/components/schemas/ExampleResponse"
                    example:
                      $ref: "#/components/schemas/ExampleResponse"
        schemas:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/ParameterSchema"
        security:
          type: array
          items:
            type: object
            properties:
              securityScheme:
                type: string
                enum: ["apiKey", "http", "oauth2"]

    MetadataInfo:
      type: object
      description: "元数据信息"
      properties:
        summary:
          type: string
          description: "摘要"
        path:
          type: string
          description: "路径"
        method:
          type: string
          description: "方法"
        description:
          type: string
          description: "描述"
        server_url:
          type: array
          items:
            type: string
            description: "服务器地址"
        api_spec:
          $ref: "#/components/schemas/APISpec"
        function_content:
          $ref: "#/components/schemas/FunctionContent"
    FunctionContent:
      type: object
      description: 函数内容
      properties:
        script_type:
          type: string
          description: "脚本类型"
          enum: ["python"]
        code:
          type: string
          description: "函数代码"
        dependencies:
          type: array
          items:
            type: string
            description: "依赖包列表"
    ParameterSchema:
      type: object
      properties:
        type:
          type: string
          enum: ["string", "number", "integer", "boolean", "array"]
        format:
          type: string
          enum: ["int32", "int64", "float", "double", "byte"]
        example:
          type: string
    ExampleRequest:
      type: object
      properties:
        field1:
          type: string
          example: "sample_value"
        field2:
          type: integer
          format: int32
          example: 123
    ExampleResponse:
      type: object
      properties:
        code:
          type: integer
          format: int32
          example: 200
        data:
          type: object
          properties:
            result:
              type: string
              example: "success"
    OperatorEditReq:
      type: object
      description: "算子编辑请求"
      required:
        - "operator_id"
      properties:
        operator_id:
          type: string
          description: "算子ID"
        name:
          type: string
          description: "算子名称"
        description:
          type: string
          description: "算子描述"
        operator_info:
          $ref: "#/components/schemas/OperatorInfoEdit"
        operator_execute_control:
          $ref: "#/components/schemas/OperatorExecuteControl"
        extend_info:
          type: object
          description: "扩展信息"
        metadata_type:
          type: string
          description: "算子元数据类型"
          enum:
            - "openapi"
            - "function"
        data:
          type: string
          format: binary
          description: "OpenAPI 数据，[]byte 类型, 当 metadata_type 为 openapi 时有效"
        function_input:
          type: object
          description: "函数编辑参数，当 metadata_type 为 function 时有效"
          $ref: "#/components/schemas/FunctionInputEdit"
    OperatorDataInfo:
      type: object
      required:
        - "operator_id"
        - "version"
      description: "算子信息"
      properties:
        name:
          type: string
          description: "算子名称"
        operator_id:
          type: string
          description: "算子ID"
        version:
          type: string
          description: "算子版本"
        status:
          type: string
          description: "算子状态"
          enum:
            - "unpublish"
            - "published"
            - "offline"
            - "editing"
        metadata_type:
          type: string
          description: "算子元数据类型"
          enum:
            - "openapi"
            - "function"
        metadata:
          $ref: "#/components/schemas/MetadataInfo"
        operator_info:
          $ref: "#/components/schemas/OperatorInfo"
        operator_execute_control:
          $ref: "#/components/schemas/OperatorExecuteControl"
        extend_info:
          type: object
          description: "扩展信息"
        create_time:
          type: integer
          description: "创建时间"
        update_time:
          type: integer
          description: "更新时间"
        create_user:
          type: string
          description: "创建用户"
        update_user:
          type: string
          description: "更新用户"
        release_user:
          type: string
          description: "发布用户"
        release_time:
          type: integer
          description: "发布时间"
        tag:
          type: string
          description: "语义版本号"
        is_internal:
          type: boolean
          description: "是否为内部算子"
    OperatorRegisterReq:
      type: object
      description: "算子注册请求"
      required:
        - "operator_metadata_type"
      properties:
        data:
          type: string
          description: "OpenAPI 数据，[]byte 类型, 当 operator_metadata_type 为 openapi 时必填"
        function_input:
          type: object
          description: "函数编辑参数，当 operator_metadata_type 为 function 时有效"
          $ref: "#/components/schemas/FunctionInput"
        operator_metadata_type:
          type: string
          description: "算子元数据类型"
          enum:
            - "openapi"
            - "function"
        operator_info:
          $ref: "#/components/schemas/OperatorInfo"
        operator_execute_control:
          $ref: "#/components/schemas/OperatorExecuteControl"
        extend_info:
          type: object
          description: "算子拓展信息"
        direct_publish:
          type: boolean
          description: "是否直接发布算子"
        user_token:
          type: string
          description: "内部接口传参，用于认证用户身份"
    OperatorRegisterResp:
      type: array
      items:
        type: object
        required:
          - "status"
        properties:
          status:
            type: string
            description: "算子状态"
            enum:
              - "success"
              - "failed"
          operator_id:
            type: string
            description: "算子ID"
          version:
            type: string
            description: "算子版本"
          error:
            $ref: "#/components/schemas/Error"
    OperatorInfoEdit:
      type: object
      description: "算子信息"
      properties:
        operator_type:
          type: string
          description: "basic: 基础算子, composite: 组合算子, 默认为basic"
          default: "basic"
          enum:
            - "basic"
            - "composite"
        execution_mode:
          type: string
          description: "sync: 同步执行, async: 异步执行, 默认为sync"
          default: "sync"
          enum:
            - "sync"
            - "async"
        category:
          type: string
          description: "算子分类，默认为other_category（其他/数据处理/数据转换/数据存储/数据分析/数据查询/数据抽取/数据分割/模型训练）"
          default: "other_category"
        source:
          type: string
          description: "算子来源, 默认为unknown, 可选值为system/unknown, 如果是system不允许修改"
          default: "unknown"
          enum:
            - "system"
            - "unknown"
        is_data_source:
          type: boolean
          description: "是否为数据源算子"
          default: false
    OperatorInfo:
      type: object
      description: "算子信息"
      properties:
        operator_type:
          type: string
          description: "basic: 基础算子, composite: 组合算子, 默认为basic"
          default: "basic"
          enum:
            - "basic"
            - "composite"
        execution_mode:
          type: string
          description: "sync: 同步执行, async: 异步执行, 默认为sync"
          default: "sync"
          enum:
            - "sync"
            - "async"
        category:
          type: string
          description: "算子分类，默认为other_category（其他/数据处理/数据转换/数据存储/数据分析/数据查询/数据抽取/数据分割/模型训练）"
          default: "other_category"
          enum:
            - "other_category" # 自定义
            - "data_process" # 数据处理
            - "data_transform" # 数据转换
            - "data_store" # 数据存储
            - "data_analysis" # 数据分析
            - "data_query" # 数据查询
            - "data_extract" # 数据抽取
            - "data_split" # 数据分割
            - "model_train" # 模型训练
        category_name:
          type: string
          description: "算子分类名称"
        source:
          type: string
          description: "算子来源, 默认为unknown, 可选值为system/unknown, 如果是system不允许修改"
          default: "unknown"
          enum:
            - "system"
            - "unknown"
        is_data_source:
          type: boolean
          description: "是否为数据源算子"
          default: false
    OperatorExecuteControl:
      type: object
      description: "算子执行控制"
      properties:
        timeout:
          type: integer
          description: "超时时间（毫秒）"
        retry_policy:
          type: object
          description: "重试策略"
          properties:
            max_attempts:
              type: integer
              description: "最大重试次数"
              default: 3
            initial_delay:
              type: integer
              description: "初始延迟时间(毫秒)"
              default: 1000
            max_delay:
              type: integer
              description: "最大延迟时间(毫秒)"
              default: 6000
            backoff_factor:
              type: integer
              description: "退避因子"
              default: 2
            retry_conditions:
              type: object
              description: "重试条件"
              properties:
                status_code:
                  type: array
                  description: "HTTP状态码"
                  items:
                    type: integer
                error_codes:
                  type: array
                  description: "异常类型"
                  items:
                    type: string
    OperatorDeleteItem:
      type: object
      required:
        - operator_id
        - version
      properties:
        operator_id:
          type: string
          description: "算子ID"
          example: "op-123456"
        version:
          type: string
          description: "算子版本"
          example: "1.0.0"
    OperatorDeleteReq:
      type: array
      items:
        $ref: "#/components/schemas/OperatorDeleteItem"
      description: "算子删除请求"
      example:
        - operator_id: "op-123456"
          version: "1.0.0"
        - operator_id: "op-789012"
          version: "2.1.0"
    OperatorStatusItem:
      type: object
      required:
        - operator_id
        - status
      properties:
        operator_id:
          type: string
          description: "算子ID"
        status:
          type: string
          description: "算子状态"
          enum: ["unpublish", "published", "offline"]
          example: "published"
    OperatorStatusUpdateReq:
      type: array
      items:
        $ref: "#/components/schemas/OperatorStatusItem"
      description: "算子状态更新请求"
      example:
        - operator_id: "op-123456"
          status: "published"
        - operator_id: "op-789012"
          status: "offline"
    OperatorDebugReq:
      type: object
      description: "算子调试请求"
      required:
        - operator_id
        - version
      properties:
        operator_id:
          type: string
          description: "算子ID"
        version:
          type: string
          description: "算子版本"
        header:
          type: object
          description: "请求头"
          additionalProperties:
            type: object
        body:
          type: object
          description: "请求体"
        query:
          type: object
          description: "查询参数"
          additionalProperties:
            type: object
        path:
          type: object
          description: "路径参数"
          additionalProperties:
            type: string
    OperatorDebugResp:
      type: object
      description: "算子调试响应"
      properties:
        status_code:
          type: integer
          description: "HTTP状态码"
          example: 200
        headers:
          type: object
          description: "响应头"
          additionalProperties: true
        body:
          type: object
          description: "响应体"
        error:
          type: string
          description: "错误信息"
        duration_ms:
          type: integer
          description: "处理时间（毫秒）"
    OperatorIntCompReq:
      type: object
      description: "内置算子注册更新请求"
      required:
        - operator_id
        - name
        - metadata_type
        - operator_type
        - execution_mode
        - source
        - config_source
        - config_version
      properties:
        operator_id:
          type: string
          description: "算子ID"
        name:
          type: string
          description: "算子名称"
        metadata_type:
          type: string
          description: "算子元数据类型"
          enum:
            - "openapi"
            - "function"
        data:
          type: string
          description: "算子数据，当 metadata_type 为 openapi 时必填"
          format: binary
        function_input:
          type: object
          description: "函数内容，当 metadata_type 为 function 时必填"
          $ref: "#/components/schemas/FunctionInput"
        operator_type:
          type: string
          description: "算子类型"
          enum:
            - "basic"
            - "composite"
        execution_mode:
          type: string
          description: "算子执行模式"
          enum:
            - "sync"
            - "async"
        source:
          type: string
          description: "算子来源"
          default: "internal"
        operator_execute_control:
          $ref: "#/components/schemas/OperatorExecuteControl"
        extend_info:
          type: object
          description: "算子拓展信息"
        config_source:
          type: string
          description: "配置来源"
          enum:
            - "auto"
            - "manual"
        config_version:
          type: string
          description: "配置版本"
        protected_flag:
          type: boolean
          description: "是否保护"
        is_data_source:
          type: boolean
          description: "是否为数据源算子"
          default: false
    OperatorIntCompResp:
      type: object
      description: "内置算子注册更新响应"
      required:
        - operator_id
        - version
        - status
      properties:
        status:
          type: string
          description: "状态"
          enum:
            - "success"
            - "failed"
        operator_id:
          type: string
          description: "算子ID"
        version:
          type: string
          description: "算子元数据版本"
    FunctionInputEdit:
      type: object
      description: "函数编辑参数，当 metadata_type 为 function 时必填"
      properties:
        inputs:
          type: array
          description: "参数列表"
          items:
            $ref: "#/components/schemas/FunctionParameterDef"
        outputs:
          type: array
          description: "输出参数列表"
          items:
            $ref: "#/components/schemas/FunctionParameterDef"
        code:
          type: string
          description: "函数代码"
        script_type:
          type: string
          description: "函数运行时"
          default: "python"
          enum: ["python"]

    FunctionInput:
      type: object
      description: "函数参数"
      properties:
        name:
          type: string
          description: "参数名"
        description:
          type: string
          description: "参数描述"
        inputs:
          type: array
          description: "参数列表"
          items:
            $ref: "#/components/schemas/FunctionParameterDef"
        outputs:
          type: array
          description: "输出参数列表"
          items:
            $ref: "#/components/schemas/FunctionParameterDef"
        code:
          type: string
          description: "函数代码"
        script_type:
          type: string
          description: "函数运行时"
          default: "python"
          enum: ["python"]
    FunctionParameterDef:
      type: object
      description: "函数参数定义"
      properties:
        name:
          type: string
          description: "参数名"
        description:
          type: string
          description: "参数描述"
        default:
          type: object
          description: "参数默认值"
        type:
          type: string
          description: "参数类型"
          enum: ["string", "object", "number", "boolean", "array"]
        required:
          type: boolean
          description: "是否必填"
        example:
          type: object
          description: "参数示例"
        enum:
          type: array
          description: "参数枚举值"
          items:
            type: object
            description: "枚举值"
        sub_parameters:
          type: array
          description: "子参数列表; 当 type 为 array, object时有效; 当type=array时，仅第一个参数有效"
          items:
            $ref: "#/components/schemas/FunctionParameterDef"
