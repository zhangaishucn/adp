{
    "openapi": "3.0.2",
    "info": {
        "title": "Authentication服务内部API",
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "http://{host}:{port}/api",
            "description": "",
            "variables": {
                "host": {
                    "default": "host",
                    "description": "服务器IP"
                },
                "port": {
                    "default": "9080",
                    "description": "内部API http默认端口9080"
                }
            }
        }
    ],
    "security": [],
    "paths": {
        "/authentication/v1/session/{id}": {
            "get": {
                "tags": [
                    "session管理"
                ],
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/GetSessionRes"
                                },
                                "examples": {
                                    "getSession": {
                                        "value": {
                                            "subject": "test",
                                            "client_id": "a72cae35-55b6-4432-807e-b5bd700c262c",
                                            "session_id": "aabbccddeeffgghh",
                                            "context": {}
                                        }
                                    }
                                }
                            }
                        },
                        "description": "接口调用成功"
                    },
                    "404": {
                        "$ref": "#/components/responses/StatusCode404"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "获取session记录"
            },
            "put": {
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/PutSessionReq"
                            }
                        }
                    },
                    "required": true
                },
                "tags": [
                    "session管理"
                ],
                "responses": {
                    "201": {
                        "headers": {
                            "Location": {
                                "schema": {
                                    "format": "uri",
                                    "type": "string"
                                },
                                "description": "获取session `/api/authentication/v1/session/{session_id}`"
                            }
                        },
                        "description": "接口调用成功"
                    },
                    "400": {
                        "$ref": "#/components/responses/StatusCode400"
                    },
                    "404": {
                        "$ref": "#/components/responses/StatusCode404"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "保存session记录"
            },
            "delete": {
                "tags": [
                    "session管理"
                ],
                "responses": {
                    "204": {
                        "$ref": "#/components/responses/StatusCode204"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "删除session记录"
            },
            "parameters": [
                {
                    "name": "id",
                    "description": "session ID",
                    "schema": {
                        "type": "string"
                    },
                    "in": "path",
                    "required": true
                }
            ]
        },
        "/authentication/v1/config/{fields}": {
            "get": {
                "tags": [
                    "配置管理"
                ],
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/Configs"
                                }
                            }
                        },
                        "description": "接口调用成功"
                    },
                    "400": {
                        "$ref": "#/components/responses/StatusCode400"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "获取认证配置"
            },
            "put": {
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/Configs"
                            }
                        }
                    },
                    "required": true
                },
                "tags": [
                    "配置管理"
                ],
                "responses": {
                    "204": {
                        "$ref": "#/components/responses/StatusCode204"
                    },
                    "400": {
                        "$ref": "#/components/responses/StatusCode400"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "设置认证配置"
            },
            "parameters": [
                {
                    "name": "fields",
                    "description": "可获取配置字段：(可任意组合，若获取多个则以\",\"间隔)\n- `remember_for`    记住登录状态时间\n- `remember_visible`    记住登录状态按钮是否可见\n- `anonymous_sms_expiration` 匿名登录短信验证码过期时间，单位分钟",
                    "schema": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    },
                    "in": "path",
                    "required": true
                }
            ]
        },
        "/authentication/v1/access-token-perm/app/{app_id}": {
            "put": {
                "tags": [
                    "访问令牌权限管理"
                ],
                "responses": {
                    "204": {
                        "description": "调用接口成功"
                    },
                    "400": {
                        "$ref": "#/components/responses/StatusCode400"
                    },
                    "404": {
                        "$ref": "#/components/responses/StatusCode404"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "配置应用账户获取任意用户访问令牌的权限"
            },
            "delete": {
                "tags": [
                    "访问令牌权限管理"
                ],
                "responses": {
                    "204": {
                        "description": "调用接口成功"
                    },
                    "400": {
                        "$ref": "#/components/responses/StatusCode400"
                    },
                    "404": {
                        "$ref": "#/components/responses/StatusCode404"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "删除应用账户获取任意用户访问令牌的权限"
            },
            "parameters": [
                {
                    "name": "app_id",
                    "description": "应用账户id",
                    "schema": {
                        "type": "string"
                    },
                    "in": "path",
                    "required": true
                }
            ]
        },
        "/authentication/v1/access-token-perm/app": {
            "get": {
                "tags": [
                    "访问令牌权限管理"
                ],
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    }
                                },
                                "examples": {
                                    "PermApps": {
                                        "value": [
                                            "ad247f4c-dd2f-11ea-b573-005056822eb7",
                                            "d61afd49-a75d-4922-8035-ac9932039a61"
                                        ]
                                    }
                                }
                            }
                        },
                        "description": "接口调用成功"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "获取所有具备获取任意用户访问令牌权限的应用账户"
            }
        },
        "/authentication/v1/token-hook": {
            "post": {
                "tags": [
                    "Webhook"
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/SessionBody"
                            }
                        }
                    },
                    "required": true
                },
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/TokenHookClaims"
                                }
                            }
                        },
                        "description": "接口调用成功"
                    },
                    "204": {
                        "description": "调用接口成功"
                    },
                    "400": {
                        "$ref": "#/components/responses/StatusCode400"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "Webhook"
            }
        },
        "/authentication/v1/client-account-auth": {
            "post": {
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/ClientLoginReq"
                            }
                        }
                    },
                    "required": true
                },
                "tags": [
                    "登录认证"
                ],
                "responses": {
                    "200": {
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/ClientLoginRes"
                                }
                            }
                        },
                        "description": "调用成功"
                    },
                    "400": {
                        "$ref": "#/components/responses/StatusCode400"
                    },
                    "401": {
                        "$ref": "#/components/responses/StatusCode401"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "客户端账号密码认证"
            }
        },
        "/authentication/v1/audit-log": {
            "post": {
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/AuditLogInfo"
                            }
                        }
                    },
                    "required": true
                },
                "tags": [
                    "审计日志"
                ],
                "responses": {
                    "204": {
                        "$ref": "#/components/responses/StatusCode204"
                    },
                    "400": {
                        "$ref": "#/components/responses/StatusCode400"
                    },
                    "500": {
                        "$ref": "#/components/responses/StatusCode500"
                    }
                },
                "summary": "记录审计日志"
            }
        }
    },
    "components": {
        "schemas": {
            "Err": {
                "description": "接口调用错误信息结构基类，具体错误情况可查看新增的字段detail",
                "required": [
                    "code",
                    "message",
                    "cause"
                ],
                "type": "object",
                "properties": {
                    "code": {
                        "format": "int64",
                        "description": "业务错误码，前三位为 HTTP标准状态码，中间三位为系统内全局唯一的微服务错误码标识号，后三位为自定义状态码。\n",
                        "type": "integer"
                    },
                    "message": {
                        "description": "业务错误信息，与code一一对应。",
                        "type": "string"
                    },
                    "cause": {
                        "description": "导致此错误的原因，也可用于给接口调用者提示解决此错误的办法，相同的code可对应不同的cause。",
                        "type": "string"
                    },
                    "detail": {
                        "description": "错误辅助信息",
                        "type": "object"
                    }
                }
            },
            "Context": {
                "description": "context是一个可选对象，可以保存任意数据。在“context”字段下获取授权请求时，数据将可用。这在登录和授权端点共享数据的情况下很有用。",
                "type": "object",
                "properties": {
                    "property1": {
                        "type": "object"
                    },
                    "property2": {
                        "type": "object"
                    }
                }
            },
            "GetSessionRes": {
                "description": "",
                "required": [
                    "subject",
                    "client_id",
                    "session_id",
                    "context"
                ],
                "type": "object",
                "properties": {
                    "subject": {
                        "description": "经过身份验证的用户ID"
                    },
                    "client_id": {
                        "description": "客户端ID"
                    },
                    "session_id": {
                        "description": "session ID"
                    },
                    "context": {
                        "$ref": "#/components/schemas/Context",
                        "description": "context是一个可选对象，可以保存任意数据。在“context”字段下获取授权请求时，数据将可用。这在登录和授权端点共享数据的情况下很有用。"
                    }
                }
            },
            "PutSessionReq": {
                "description": "",
                "required": [
                    "subject",
                    "client_id",
                    "remember_for",
                    "context"
                ],
                "type": "object",
                "properties": {
                    "subject": {
                        "description": "经过身份验证的用户id",
                        "type": "string"
                    },
                    "client_id": {
                        "description": "客户端ID",
                        "type": "string"
                    },
                    "remember_for": {
                        "format": "int64",
                        "description": "设置应记住的的认证时间（以秒为单位）。如果设置为0，将在浏览器会话期间（使用cookie）记住该授权。",
                        "type": "integer"
                    },
                    "context": {
                        "$ref": "#/components/schemas/Context",
                        "description": "context是一个可选对象，可以保存任意数据。在“context”字段下获取授权请求时，数据将可用。这在登录和授权端点共享数据的情况下很有用。",
                        "properties": {
                            "property1": {
                                "type": "object"
                            },
                            "property2": {
                                "type": "object"
                            }
                        }
                    }
                }
            },
            "Configs": {
                "description": "",
                "type": "object",
                "properties": {
                    "remember_for": {
                        "format": "int64",
                        "description": "设置应记住的的认证时间（以秒为单位）。值为非负整数，如果设置为0，将在浏览器会话期间（使用cookie）记住该授权。",
                        "type": "integer"
                    },
                    "remember_visible": {
                        "description": "记住登录状态按钮是否可见，默认为true。",
                        "type": "boolean"
                    },
                    "anonymous_sms_expiration": {
                        "format": "int64",
                        "description": "匿名登录短信验证码过期时间，单位分钟",
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 60
                    }
                }
            },
            "SessionBody": {
                "type": "object",
                "properties": {
                    "session": {
                        "type": "object",
                        "properties": {
                            "id_token": {
                                "type": "object",
                                "properties": {
                                    "id_token_claims": {
                                        "type": "object",
                                        "properties": {
                                            "jti": {
                                                "type": "string"
                                            },
                                            "iss": {
                                                "type": "string"
                                            },
                                            "sub": {
                                                "type": "string"
                                            },
                                            "aud": {
                                                "type": "array",
                                                "items": {
                                                    "type": "string"
                                                }
                                            },
                                            "nonce": {
                                                "type": "string"
                                            },
                                            "at_hash": {
                                                "type": "string"
                                            },
                                            "acr": {
                                                "type": "string"
                                            },
                                            "amr": {},
                                            "c_hash": {
                                                "type": "string"
                                            },
                                            "ext": {
                                                "type": "object"
                                            }
                                        }
                                    },
                                    "headers": {
                                        "type": "object",
                                        "properties": {
                                            "extra": {
                                                "type": "object"
                                            }
                                        }
                                    },
                                    "username": {
                                        "type": "string"
                                    },
                                    "subject": {
                                        "type": "string"
                                    }
                                }
                            },
                            "extra": {
                                "type": "object"
                            },
                            "client_id": {
                                "type": "string"
                            },
                            "consent_challenge": {
                                "type": "string"
                            },
                            "exclude_not_before_claim": {
                                "type": "boolean"
                            },
                            "allowed_top_level_claims": {
                                "type": "array",
                                "items": {}
                            }
                        }
                    },
                    "request": {
                        "type": "object",
                        "properties": {
                            "client_id": {
                                "type": "string"
                            },
                            "granted_scopes": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "granted_audience": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "grant_types": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "payload": {
                                "type": "object",
                                "properties": {
                                    "assertion": {
                                        "type": "array",
                                        "description": "只有在jwt-bearer授权类型时，assertion为必需字段",
                                        "items": {
                                            "type": "string"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "TokenHookClaims": {
                "type": "object",
                "properties": {
                    "session": {
                        "type": "object",
                        "properties": {
                            "access_token": {
                                "type": "object"
                            },
                            "id_token": {
                                "type": "object"
                            }
                        }
                    }
                }
            },
            "ClientLoginOption": {
                "description": "用户登录附带信息",
                "type": "object",
                "properties": {
                    "uuid": {
                        "description": "验证码唯一标识",
                        "type": "string"
                    },
                    "vcode": {
                        "description": "验证码字符串/动态密码otp",
                        "type": "string"
                    },
                    "vcodeType": {
                        "description": "验证码类型",
                        "type": "integer"
                    }
                },
                "example": {
                    "uuid": "some text",
                    "vcode": "some text",
                    "vcodeType": 1
                }
            },
            "ClientLoginReq": {
                "description": "",
                "required": [
                    "account",
                    "password",
                    "method"
                ],
                "type": "object",
                "properties": {
                    "account": {
                        "description": "用户登录账号",
                        "type": "string"
                    },
                    "password": {
                        "description": "明文",
                        "type": "string"
                    },
                    "method": {
                        "description": "方法",
                        "enum": [
                            "GET"
                        ],
                        "type": "string"
                    },
                    "option": {
                        "$ref": "#/components/schemas/ClientLoginOption",
                        "description": "用户登录附带选项信息"
                    }
                },
                "example": {
                    "method": "GET",
                    "account": "test01",
                    "password": "pwd01"
                }
            },
            "ClientLoginRes": {
                "description": "",
                "required": [
                    "user_id"
                ],
                "type": "object",
                "properties": {
                    "user_id": {
                        "description": "用户ID",
                        "type": "string"
                    }
                },
                "example": {
                    "user_id": "some text"
                }
            },
            "AuditLogInfo": {
                "description": "",
                "required": [
                    "topic",
                    "message"
                ],
                "type": "object",
                "properties": {
                    "topic": {
                        "description": "日志类型",
                        "type": "string"
                    },
                    "message": {
                        "description": "日志内容",
                        "type": "object",
                        "additionalProperties": true
                    }
                }
            }
        },
        "responses": {
            "StatusCode400": {
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Err"
                        },
                        "examples": {
                            "ResErrExampleOf400": {
                                "value": {
                                    "code": 400000000,
                                    "message": "请求错误",
                                    "cause": "请求参数错误"
                                }
                            }
                        }
                    }
                },
                "description": "非法请求"
            },
            "StatusCode500": {
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Err"
                        },
                        "examples": {
                            "ResErrExampleOf500": {
                                "value": {
                                    "code": 500000000,
                                    "message": "内部错误",
                                    "cause": "xxxx"
                                }
                            }
                        }
                    }
                },
                "description": "服务器错误"
            },
            "StatusCode404": {
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Err"
                        },
                        "examples": {
                            "ResErrExampleOf404": {
                                "value": {
                                    "code": 404019001,
                                    "message": "数据不存在",
                                    "cause": "用户不存在"
                                }
                            }
                        }
                    }
                },
                "description": "资源不存在"
            },
            "StatusCode204": {
                "description": "无内容"
            },
            "StatusCode401": {
                "content": {
                    "application/json": {
                        "schema": {
                            "$ref": "#/components/schemas/Err"
                        }
                    }
                },
                "description": "未授权"
            }
        }
    },
    "tags": [
        {
            "name": "session管理",
            "description": ""
        },
        {
            "name": "配置管理",
            "description": ""
        },
        {
            "name": "登录认证",
            "description": ""
        }
    ]
}