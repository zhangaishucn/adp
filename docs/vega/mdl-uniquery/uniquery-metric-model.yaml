---
openapi: 3.0.0
info:
  title: uniquery-for-metricmodel
  version: "1.0"
servers:
  - url: http://localhost:13011
paths:
  /api/mdl-uniquery/v1/health:
    get:
      responses:
        "200":
          description: ok
      summary: health
      description: "健康检查API, AnyRobot 3.0.18.1版本及以上支持"
  /api/mdl-uniquery/v1/metric-model:
    summary: 基于指标模型的数据预览
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReqMetricModelSimulate"
            examples:
              范围查询-promql-预览:
                value:
                  metric_type: atomic
                  data_source:
                    type: view_1
                    id: wretrtyuiol675342rfgf
                  query_type: promql
                  formula:
                    "avg(irate(node_cpu_seconds_total{name=~\"node-14-35\"\
                    ,mode=\"system\"}[5m]))by(name)"
                  instant: false
                  start: 1646360670123
                  end: 1646471470123
                  step: 1m
              即时查询-promql-预览:
                value:
                  metric_type: atomic
                  data_source:
                    type: view_1
                    id: wretrtyuiol675342rfgf
                  query_type: promql
                  formula:
                    "avg(irate(node_cpu_seconds_total{name=~\"node-14-35\"\
                    ,mode=\"system\"}[5m]))by(name)"
                  instant: true
                  start: 1669779900123
                  end: 1669789900123
              范围查询-dsl-预览:
                value:
                  metric_type: atomic
                  data_source:
                    type: view_1
                    id: wretrtyuiol675342rfgf
                  query_type: dsl
                  formula:
                    "{    \"size\":0,    \"query\":{        \"bool\":{    \
                    \        \"filter\":[                {                    \"range\"\
                    :{                        \"labels.cpu.keyword\":{           \
                    \                 \"lte\":\"2\"                        }     \
                    \               }                },                {         \
                    \           \"range\":{                        \"metrics.node_cpu_seconds_total\"\
                    :{                            \"gte\":0                      \
                    \  }                    }                }            ]      \
                    \  }    },    \"sort\":[        {            \"@timestamp\":{\
                    \                \"order\":\"desc\"            }        }    ],\
                    \    \"aggregations\":{        \"cpu2\":{            \"terms\"\
                    :{                \"field\":\"labels.cpu.keyword\",          \
                    \      \"size\":10000            },            \"aggs\":{    \
                    \            \"mode\":{                    \"terms\":{       \
                    \                 \"field\":\"labels.mode.keyword\",         \
                    \               \"size\":100000                    },        \
                    \            \"aggs\":{                        \"time2\":{   \
                    \                         \"date_histogram\":{               \
                    \                 \"field\":\"@timestamp\",                  \
                    \              \"fixed_interval\":\"1h\",                    \
                    \            \"format\":\"yyyy-MM-dd HH:mm:ss.SSS\",         \
                    \                       \"min_doc_count\":1,                 \
                    \               \"order\":{                                  \
                    \  \"_key\":\"asc\"                                }         \
                    \                   },                            \"aggs\":{ \
                    \                               \"cnt_v\":{                  \
                    \                  \"value_count\":{                         \
                    \               \"field\":\"@timestamp\"                     \
                    \               }                                }           \
                    \                 }                        }                 \
                    \   }                }            }        }    }}"
                  measure_field: value
                  instant: false
                  start: 1646360670123
                  end: 1646471470123
                  step: 1m
              即时查询-dsl-预览:
                value:
                  metric_type: atomic
                  data_source:
                    type: view_1
                    id: wretrtyuiol675342rfgf
                  query_type: dsl
                  formula:
                    "{    \"size\":0,    \"query\":{        \"bool\":{    \
                    \        \"filter\":[                {                    \"range\"\
                    :{                        \"labels.cpu.keyword\":{           \
                    \                 \"lte\":\"2\"                        }     \
                    \               }                },                {         \
                    \           \"range\":{                        \"metrics.node_cpu_seconds_total\"\
                    :{                            \"gte\":0                      \
                    \  }                    }                }            ]      \
                    \  }    },    \"sort\":[        {            \"@timestamp\":{\
                    \                \"order\":\"desc\"            }        }    ],\
                    \    \"aggregations\":{        \"cpu2\":{            \"terms\"\
                    :{                \"field\":\"labels.cpu.keyword\",          \
                    \      \"size\":10000            },            \"aggs\":{    \
                    \            \"mode\":{                    \"terms\":{       \
                    \                 \"field\":\"labels.mode.keyword\",         \
                    \               \"size\":100000                    },        \
                    \            \"aggs\":{                        \"time2\":{   \
                    \                         \"date_histogram\":{               \
                    \                 \"field\":\"@timestamp\",                  \
                    \              \"fixed_interval\":\"1h\",                    \
                    \            \"format\":\"yyyy-MM-dd HH:mm:ss.SSS\",         \
                    \                       \"min_doc_count\":1,                 \
                    \               \"order\":{                                  \
                    \  \"_key\":\"asc\"                                }         \
                    \                   },                            \"aggs\":{ \
                    \                               \"cnt_v\":{                  \
                    \                  \"value_count\":{                         \
                    \               \"field\":\"@timestamp\"                     \
                    \               }                                }           \
                    \                 }                        }                 \
                    \   }                }            }        }    }}"
                  measure_field: value
                  instant: true
                  start: 1669779900123
                  end: 1669789900123
        required: true
      parameters:
        - name: X-HTTP-Method-Override
          description: 重载 post，实际上是 get 方法
          schema:
            enum:
              - GET
            type: string
          in: header
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MetricResultsSimulate"
              examples:
                范围查询-promql-预览:
                  value:
                    datas:
                      - labels:
                          cpu: "1"
                          instance: 10.4.68.120:9101
                        times:
                          - 1669789800123
                          - 1669789900123
                        values:
                          - 10
                          - 11
                      - labels:
                          cpu: "2"
                          instance: 10.4.68.120:9101
                        times:
                          - 1669789800123
                          - 1669789900123
                        values:
                          - 10
                          - 11
                    step: 1m
                    is_variable: false
                即时查询-promql-预览:
                  value:
                    datas:
                      - labels:
                          cpu: "1"
                          instance: 10.4.68.120:9101
                        times:
                          - 1669789900123
                        values:
                          - 10
                      - labels:
                          cpu: "2"
                          instance: 10.4.68.120:9101
                        times:
                          - 1669789900123
                        values:
                          - 10
                    step: ""
                    is_variable: false
                范围查询-dsl-预览:
                  value:
                    datas:
                      - labels:
                          cpu: "1"
                          mode: idle
                        times:
                          - 1669789800123
                          - 1669789900123
                        values:
                          - 100
                          - 11
                      - labels:
                          cpu: "1"
                          mode: iowait
                        times:
                          - 1669789800123
                          - 1669789900123
                        values:
                          - 10
                          - 11
                    step: 1h
                    is_variable: false
                即时查询-dsl-预览:
                  value:
                    datas:
                      - labels:
                          cpu: "1"
                          mode: idle
                        times:
                          - 1669789900123
                        values:
                          - 10
                      - labels:
                          cpu: "2"
                          model: iowait
                        times:
                          - 1669789900123
                        values:
                          - 10
                    step: ""
                    is_variable: false
          description: OK
        "400":
          $ref: "#/components/responses/400BadRequest"
        "500":
          $ref: "#/components/responses/500InternalError"
      summary: metric-model
      description: 基于指标模型的数据预览
  /api/mdl-uniquery/v1/metric-models/{ids}:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReqMetricModel"
            examples:
              范围查询 - 请求单个模型:
                value:
                  instant: false
                  start: 1646360670123
                  end: 1646471470123
                  step: 1m
                  filters:
                    - name: labels.host
                      value:
                        - 10.2.12.23
                        - 10.21.2.3
                      operation: in
                    - name: labels.job
                      value: prometheus
                      operation: "="
                    - name: labels.namespace
                      value: as
                      operation: "!="
                    - name: metrics.node_cpu_seconds_total
                      value:
                        - 0
                        - 5
                      operation: range
                    - name: metrics.node_memory_MemTotal_bytes
                      value:
                        - 1024
                        - 2048
                      operation: out_range
              即时查询 - 请求单个模型:
                value:
                  instant: true
                  start: 1669779900123
                  end: 1669789900123
                  filters:
                    - name: labels.host
                      value:
                        - 10.2.12.23
                        - 10.21.2.3
                      operation: in
                    - name: labels.job
                      value: prometheus
                      operation: "="
                    - name: labels.namespace
                      value: as
                      operation: "!="
                    - name: metrics.node_cpu_seconds_total
                      value:
                        - 0
                        - 5
                      operation: range
                    - name: metrics.node_memory_MemTotal_bytes
                      value:
                        - 1024
                        - 2048
                      operation: out_range
              范围查询 - 请求多个模型:
                value:
                  - instant: false
                    start: 1646360670123
                    end: 1646471470123
                    step: 1m
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
                      - name: labels.job
                        value: prometheus
                        operation: "="
                      - name: labels.namespace
                        value: as
                        operation: "!="
                      - name: metrics.node_cpu_seconds_total
                        value:
                          - 0
                          - 5
                        operation: range
                      - name: metrics.node_memory_MemTotal_bytes
                        value:
                          - 1024
                          - 2048
                        operation: out_range
                  - instant: false
                    start: 1646360670123
                    end: 1646471470123
                    step: 5m
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
              即时查询 - 请求多个模型:
                value:
                  - instant: true
                    start: 1669789900123
                    end: 1669789900123
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
                      - name: labels.job
                        value: prometheus
                        operation: "="
                      - name: labels.namespace
                        value: as
                        operation: "!="
                      - name: metrics.node_cpu_seconds_total
                        value:
                          - 0
                          - 5
                        operation: range
                      - name: metrics.node_memory_MemTotal_bytes
                        value:
                          - 1024
                          - 2048
                        operation: out_range
                  - instant: true
                    start: 1669779900123
                    end: 1669789900123
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
        required: true
      parameters:
        - name: X-HTTP-Method-Override
          description: 重载 post，实际上是 get 方法
          schema:
            enum:
              - GET
            type: string
          in: header
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MetricResults"
              examples:
                范围查询 - 请求单个模型:
                  value:
                    model:
                      id: 0
                      name: some text
                      measure_name: some text
                      metric_type: atomic
                      data_view_id: some text
                      data_view_name: some text
                      query_type: dsl
                      formula: some text
                      date_field: some text
                      date_format: epoch_millis
                      measure_field: some text
                      unit_type: timeUnit
                      unit: h
                      tags:
                        - some text
                        - some text
                      custom_attribute: {}
                      comment: some text
                      update_time: some text
                      group_id: 78
                      group_name: some text
                      is_calendar_interval: 37
                      task:
                        id: 33
                        type: calendar
                        name: some text
                        model_id: 39
                        schedule:
                          type: CRON
                          expression: some text
                        time_windows:
                          - some text
                          - some text
                        steps:
                          - some text
                          - some text
                        plan_times:
                          - 38
                          - 47
                        index_base_name: some text
                        index_base: some text
                        retrace_duration: some text
                        comment: some text
                        task_schedule_id: 32
                        schedule_status: 0
                        schedule_sync_status: 38
                        execute_status: 89
                        update_time: some text
                        measure_name: some text
                    datas:
                      - labels:
                          cpu: "1"
                          instance: 10.4.68.120:9101
                        times:
                          - 1669789800123
                          - 1669789900123
                        values:
                          - 10
                          - 11
                      - labels:
                          cpu: "2"
                          instance: 10.4.68.120:9101
                        times:
                          - 1669789800123
                          - 1669789900123
                        values:
                          - 10
                          - 11
                    step: 1m
                    is_variable: false
                    is_calendar: false
                    status_code: 200
                即时查询 - 请求单个模型:
                  value:
                    model:
                      id: 0
                      name: some text
                      measure_name: some text
                      metric_type: atomic
                      data_view_id: some text
                      data_view_name: some text
                      query_type: dsl
                      formula: some text
                      date_field: some text
                      date_format: epoch_millis
                      measure_field: some text
                      unit_type: timeUnit
                      unit: h
                      tags:
                        - some text
                        - some text
                      custom_attribute: {}
                      comment: some text
                      update_time: some text
                      group_id: 78
                      group_name: some text
                      is_calendar_interval: 37
                      task:
                        id: 33
                        type: calendar
                        name: some text
                        model_id: 39
                        schedule:
                          type: CRON
                          expression: some text
                        time_windows:
                          - some text
                          - some text
                        steps:
                          - some text
                          - some text
                        plan_times:
                          - 38
                          - 47
                        index_base_name: some text
                        index_base: some text
                        retrace_duration: some text
                        comment: some text
                        task_schedule_id: 32
                        schedule_status: 0
                        schedule_sync_status: 38
                        execute_status: 89
                        update_time: some text
                        measure_name: some text
                    datas:
                      - labels:
                          cpu: "1"
                          instance: 10.4.68.120:9101
                        times:
                          - 1669789900123
                        values:
                          - 11
                      - labels:
                          cpu: "2"
                          instance: 10.4.68.120:9101
                        times:
                          - 1669789900123
                        values:
                          - 11
                    step: ""
                    is_variable: false
                    is_calendar: false
                    status_code: 200
                范围查询 - 请求多个模型:
                  value:
                    - model:
                        id: 0
                        name: some text
                        measure_name: some text
                        metric_type: atomic
                        data_view_id: some text
                        data_view_name: some text
                        query_type: dsl
                        formula: some text
                        date_field: some text
                        date_format: epoch_millis
                        measure_field: some text
                        unit_type: timeUnit
                        unit: h
                        tags:
                          - some text
                          - some text
                        custom_attribute: {}
                        comment: some text
                        update_time: some text
                        group_id: 78
                        group_name: some text
                        is_calendar_interval: 37
                        task:
                          id: 33
                          type: calendar
                          name: some text
                          model_id: 39
                          schedule:
                            type: CRON
                            expression: some text
                          time_windows:
                            - some text
                            - some text
                          steps:
                            - some text
                            - some text
                          plan_times:
                            - 38
                            - 47
                          index_base_name: some text
                          index_base: some text
                          retrace_duration: some text
                          comment: some text
                          task_schedule_id: 32
                          schedule_status: 0
                          schedule_sync_status: 38
                          execute_status: 89
                          update_time: some text
                          measure_name: some text
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                      step: 1m
                      is_variable: false
                      is_calendar: false
                      status_code: 200
                    - model:
                        id: 0
                        name: some text
                        measure_name: some text
                        metric_type: atomic
                        data_view_id: some text
                        data_view_name: some text
                        query_type: dsl
                        formula: some text
                        date_field: some text
                        date_format: epoch_millis
                        measure_field: some text
                        unit_type: timeUnit
                        unit: h
                        tags:
                          - some text
                          - some text
                        custom_attribute: {}
                        comment: some text
                        update_time: some text
                        group_id: 78
                        group_name: some text
                        is_calendar_interval: 37
                        task:
                          id: 33
                          type: calendar
                          name: some text
                          model_id: 39
                          schedule:
                            type: CRON
                            expression: some text
                          time_windows:
                            - some text
                            - some text
                          steps:
                            - some text
                            - some text
                          plan_times:
                            - 38
                            - 47
                          index_base_name: some text
                          index_base: some text
                          retrace_duration: some text
                          comment: some text
                          task_schedule_id: 32
                          schedule_status: 0
                          schedule_sync_status: 38
                          execute_status: 89
                          update_time: some text
                          measure_name: some text
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                      step: 5m
                      is_variable: false
                      is_calendar: false
                      status_code: 200
                即时查询 - 请求多个模型:
                  value:
                    - model:
                        id: 0
                        name: some text
                        measure_name: some text
                        metric_type: atomic
                        data_view_id: some text
                        data_view_name: some text
                        query_type: dsl
                        formula: some text
                        date_field: some text
                        date_format: epoch_millis
                        measure_field: some text
                        unit_type: timeUnit
                        unit: h
                        tags:
                          - some text
                          - some text
                        custom_attribute: {}
                        comment: some text
                        update_time: some text
                        group_id: 78
                        group_name: some text
                        is_calendar_interval: 37
                        task:
                          id: 33
                          type: calendar
                          name: some text
                          model_id: 39
                          schedule:
                            type: CRON
                            expression: some text
                          time_windows:
                            - some text
                            - some text
                          steps:
                            - some text
                            - some text
                          plan_times:
                            - 38
                            - 47
                          index_base_name: some text
                          index_base: some text
                          retrace_duration: some text
                          comment: some text
                          task_schedule_id: 32
                          schedule_status: 0
                          schedule_sync_status: 38
                          execute_status: 89
                          update_time: some text
                          measure_name: some text
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                      step: ""
                      is_variable: false
                      is_calendar: false
                      status_code: 200
                    - model:
                        id: "345"
                        name: model2
                        metric_type: atomic
                        data_view_name: xxx
                        query_type: promql
                        formula: "cpu_second_total{}"
                        date_field: "@timestamp"
                        date_format: epoch_millis
                        measure_field: value
                        unit_type: timeUnit
                        unit: s
                        group_id: 1111
                        group_name: 系统CPU监控
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                      step: ""
                      is_variable: false
                      is_calendar: false
                      status_code: 200
          description: OK
        "207":
          content:
            application/json:
              examples:
                exp1:
                  value:
                    - model:
                        id: "493734055943078059"
                        name: DSL日历间隔为1天-d8e655d3b-a
                        measure_name: __m.493734055943078059
                        metric_type: atomic
                        data_view_name: metricModel10451398-a
                        query_type: dsl
                        formula:
                          "{\"size\":0,\"aggs\":{\"date_histogram_name\":{\"\
                          date_histogram\":{\"field\":\"@timestamp\",\"calendar_interval\"\
                          :\"1d\"},\"aggs\":{\"metric-aggs-name\":{\"value_count\":{\"\
                          field\":\"@timestamp\"}}}}}}"
                        date_field: date_histogram_name
                        date_format: epoch_millis
                        measure_field: metric-aggs-name
                        unit_type: storeUnit
                        unit: MB
                        group_id: "493768343925293227"
                        group_name: DSL
                      datas:
                        - labels: {}
                          times:
                            - 1704338561588
                          values:
                            - 1775802
                      step: ""
                      is_variable: false
                      is_calendar: true
                      status_code: 200
                    - status_code: 404
                      error_code: Uniquery.MetricModel.MetricModelNotFound
                      description: The Metric Model Does Not Exist
                      solution: Please check whether the parameter is correct.
                      error_link: None
                      error_details: ""
                exp2:
                  value:
                    - status_code: 404
                      error_code: Uniquery.MetricModel.MetricModelNotFound
                      description: The Metric Model Does Not Exist
                      solution: Please check whether the parameter is correct.
                      error_link: None
                      error_details: ""
                    - status_code: 404
                      error_code: Uniquery.MetricModel.MetricModelNotFound
                      description: The Metric Model Does Not Exist
                      solution: Please check whether the parameter is correct.
                      error_link: None
                      error_details: ""
        "404":
          content:
            application/json:
              examples:
                exp1:
                  value:
                    error_code: Uniquery.MetricModel.MetricModelNotFound
                    description: The Metric Model Does Not Exist
                    solution: Please check whether the parameter is correct.
                    error_link: None
                    error_details: ""
      summary: "metric-models/{ids}"
      description: 根据指标模型 id 查询指标数据。可支持单个指标查询和多个指标查询。若是需要查询大于1个的指标模型的数据，则需要提交一个查询请求参数的数组，请求参数的作用域与模型id顺序对应。返回的是多个模型的数据结果的数组，数据与模型id也是顺序对应的。
    parameters:
      - name: ids
        description: 指标模型id
        schema:
          type: integer
        in: path
        required: true
      - name: ignoring_store_cache
        description: 是否查询持久化缓存下来的数据。默认为 false，不忽略
        schema:
          type: boolean
        in: query
        required: false
      - name: include_model
        description: 是否返回指标模型信息。默认为false。
        schema:
          type: boolean
        in: query
      - name: filter_mode
        description: 过滤模式
        schema:
          enum:
            - normal
            - error
            - ignore
          type: string
        in: query
      - name: fill_null
        description: 是否补空，默认为true，即补null
        schema:
          type: boolean
        in: query
      - name: ignoring_memory_cache
        description: 是否忽略内存缓存数据，默认为false，不忽略
        schema:
          type: boolean
        in: query
      - name: ignoring_hcts
        description: 是否忽略高基查询。默认为false，不忽略
        schema:
          type: boolean
        in: query
  /api/mdl-uniquery/v1/metric-model-groups/{group_name}/metric-models:
    post:
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/ReqMetricModelForGroup"
            examples:
              query range-request single model:
                value:
                  - instant: false
                    start: 1646360670123
                    end: 1646471470123
                    step: 1m
                    model_name: 系统CPU利用率
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
                      - name: labels.job
                        value: prometheus
                        operation: "="
                      - name: labels.namespace
                        value: as
                        operation: "!="
                      - name: metrics.node_cpu_seconds_total
                        value:
                          - 0
                          - 5
                        operation: range
                      - name: metrics.node_memory_MemTotal_bytes
                        value:
                          - 1024
                          - 2048
                        operation: out_range
              query-request single model:
                value:
                  - instant: true
                    start: 1669779900123
                    end: 1669789900123
                    model_name: 系统CPU利用率
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
                      - name: labels.job
                        value: prometheus
                        operation: "="
                      - name: labels.namespace
                        value: as
                        operation: "!="
                      - name: metrics.node_cpu_seconds_total
                        value:
                          - 0
                          - 5
                        operation: range
                      - name: metrics.node_memory_MemTotal_bytes
                        value:
                          - 1024
                          - 2048
                        operation: out_range
              query range-request multiple models:
                value:
                  - instant: false
                    start: 1646360670123
                    end: 1646471470123
                    step: 1m
                    model_name: 系统CPU使用
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
                      - name: labels.job
                        value: prometheus
                        operation: "="
                      - name: labels.namespace
                        value: as
                        operation: "!="
                      - name: metrics.node_cpu_seconds_total
                        value:
                          - 0
                          - 5
                        operation: range
                      - name: metrics.node_memory_MemTotal_bytes
                        value:
                          - 1024
                          - 2048
                        operation: out_range
                  - instant: false
                    start: 1646360670123
                    end: 1646471470123
                    step: 5m
                    model_name: 系统内存使用
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
              query-request multiple models:
                value:
                  - instant: true
                    start: 1669779900123
                    end: 1669789900123
                    model_name: 系统内存使用
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
                      - name: labels.job
                        value: prometheus
                        operation: "="
                      - name: labels.namespace
                        value: as
                        operation: "!="
                      - name: metrics.node_cpu_seconds_total
                        value:
                          - 0
                          - 5
                        operation: range
                      - name: metrics.node_memory_MemTotal_bytes
                        value:
                          - 1024
                          - 2048
                        operation: out_range
                  - instant: true
                    start: 1669779900123
                    end: 1669789900123
                    model_name: 系统CPU使用
                    filters:
                      - name: labels.host
                        value:
                          - 10.2.12.23
                          - 10.21.2.3
                        operation: in
        required: true
      parameters:
        - name: X-HTTP-Method-Override
          description: 重载 post，实际上是 get 方法
          schema:
            enum:
              - GET
            type: string
          in: header
          required: true
        - name: filter_mode
          description: 过滤模式
          schema:
            enum:
              - normal
              - error
              - ignore
            type: string
          in: query
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MetricResults"
              examples:
                query range-request single model:
                  value:
                    - model:
                        id: 0
                        name: some text
                        measure_name: some text
                        metric_type: atomic
                        data_view_id: some text
                        data_view_name: some text
                        query_type: dsl
                        formula: some text
                        date_field: some text
                        date_format: epoch_millis
                        measure_field: some text
                        unit_type: timeUnit
                        unit: h
                        tags:
                          - some text
                          - some text
                        custom_attribute: {}
                        comment: some text
                        update_time: some text
                        group_id: 78
                        group_name: some text
                        is_calendar_interval: 37
                        task:
                          id: 33
                          type: calendar
                          name: some text
                          model_id: 39
                          schedule:
                            type: CRON
                            expression: some text
                          time_windows:
                            - some text
                            - some text
                          steps:
                            - some text
                            - some text
                          plan_times:
                            - 38
                            - 47
                          index_base_name: some text
                          index_base: some text
                          retrace_duration: some text
                          comment: some text
                          task_schedule_id: 32
                          schedule_status: 0
                          schedule_sync_status: 38
                          execute_status: 89
                          update_time: some text
                          measure_name: some text
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                      step: 1m
                      is_variable: false
                      is_calendar: false
                      status_code: 200
                query-request single model:
                  value:
                    - model:
                        id: 0
                        name: some text
                        measure_name: some text
                        metric_type: atomic
                        data_view_id: some text
                        data_view_name: some text
                        query_type: dsl
                        formula: some text
                        date_field: some text
                        date_format: epoch_millis
                        measure_field: some text
                        unit_type: timeUnit
                        unit: h
                        tags:
                          - some text
                          - some text
                        custom_attribute: {}
                        comment: some text
                        update_time: some text
                        group_id: 78
                        group_name: some text
                        is_calendar_interval: 37
                        task:
                          id: 33
                          type: calendar
                          name: some text
                          model_id: 39
                          schedule:
                            type: CRON
                            expression: some text
                          time_windows:
                            - some text
                            - some text
                          steps:
                            - some text
                            - some text
                          plan_times:
                            - 38
                            - 47
                          index_base_name: some text
                          index_base: some text
                          retrace_duration: some text
                          comment: some text
                          task_schedule_id: 32
                          schedule_status: 0
                          schedule_sync_status: 38
                          execute_status: 89
                          update_time: some text
                          measure_name: some text
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                      step: ""
                      is_variable: false
                      is_calendar: false
                      status_code: 200
                query range-request multiple models:
                  value:
                    - model:
                        id: 0
                        name: some text
                        measure_name: some text
                        metric_type: atomic
                        data_view_id: some text
                        data_view_name: some text
                        query_type: dsl
                        formula: some text
                        date_field: some text
                        date_format: epoch_millis
                        measure_field: some text
                        unit_type: timeUnit
                        unit: h
                        tags:
                          - some text
                          - some text
                        custom_attribute: {}
                        comment: some text
                        update_time: some text
                        group_id: 78
                        group_name: some text
                        is_calendar_interval: 37
                        task:
                          id: 33
                          type: calendar
                          name: some text
                          model_id: 39
                          schedule:
                            type: CRON
                            expression: some text
                          time_windows:
                            - some text
                            - some text
                          steps:
                            - some text
                            - some text
                          plan_times:
                            - 38
                            - 47
                          index_base_name: some text
                          index_base: some text
                          retrace_duration: some text
                          comment: some text
                          task_schedule_id: 32
                          schedule_status: 0
                          schedule_sync_status: 38
                          execute_status: 89
                          update_time: some text
                          measure_name: some text
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                      step: 1m
                      is_variable: false
                      is_calendar: false
                      status_code: 200
                    - model:
                        id: "345"
                        name: model2
                        metric_type: atomic
                        data_view_name: xxx
                        query_type: promql
                        formula: "memory_used_total{}"
                        date_field: "@timestamp"
                        date_format: epoch_millis
                        measure_field: value
                        unit_type: timeUnit
                        unit: s
                        group_id: 1111
                        group_name: 系统CPU监控
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789800123
                            - 1669789900123
                          values:
                            - 10
                            - 11
                      step: 5m
                      is_variable: false
                      is_calendar: false
                      status_code: 200
                query-request multiple models:
                  value:
                    - model:
                        id: 0
                        name: some text
                        measure_name: some text
                        metric_type: atomic
                        data_view_id: some text
                        data_view_name: some text
                        query_type: dsl
                        formula: some text
                        date_field: some text
                        date_format: epoch_millis
                        measure_field: some text
                        unit_type: timeUnit
                        unit: h
                        tags:
                          - some text
                          - some text
                        custom_attribute: {}
                        comment: some text
                        update_time: some text
                        group_id: 78
                        group_name: some text
                        is_calendar_interval: 37
                        task:
                          id: 33
                          type: calendar
                          name: some text
                          model_id: 39
                          schedule:
                            type: CRON
                            expression: some text
                          time_windows:
                            - some text
                            - some text
                          steps:
                            - some text
                            - some text
                          plan_times:
                            - 38
                            - 47
                          index_base_name: some text
                          index_base: some text
                          retrace_duration: some text
                          comment: some text
                          task_schedule_id: 32
                          schedule_status: 0
                          schedule_sync_status: 38
                          execute_status: 89
                          update_time: some text
                          measure_name: some text
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                      step: ""
                      is_variable: false
                      is_calendar: false
                      status_code: 200
                    - model:
                        id: "345"
                        name: model2
                        metric_type: atomic
                        data_view_name: xxx
                        query_type: promql
                        formula: "cpu_second_total{}"
                        date_field: "@timestamp"
                        date_format: epoch_millis
                        measure_field: value
                        unit_type: timeUnit
                        unit: s
                        group_id: 1111
                        group_name: 系统CPU监控
                      datas:
                        - labels:
                            cpu: "1"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                        - labels:
                            cpu: "2"
                            instance: 10.4.68.120:9101
                          times:
                            - 1669789900123
                          values:
                            - 11
                      step: ""
                      is_variable: false
                      is_calendar: false
                      status_code: 200
          description: 查询成功
        "207":
          content:
            application/json:
              examples:
                exp1:
                  value:
                    - model:
                        id: "493734055943078059"
                        name: DSL日历间隔为1天-d8e655d3b-a
                        measure_name: __m.493734055943078059
                        metric_type: atomic
                        data_view_name: metricModel10451398-a
                        query_type: dsl
                        formula:
                          "{\"size\":0,\"aggs\":{\"date_histogram_name\":{\"\
                          date_histogram\":{\"field\":\"@timestamp\",\"calendar_interval\"\
                          :\"1d\"},\"aggs\":{\"metric-aggs-name\":{\"value_count\":{\"\
                          field\":\"@timestamp\"}}}}}}"
                        date_field: date_histogram_name
                        date_format: epoch_millis
                        measure_field: metric-aggs-name
                        unit_type: storeUnit
                        unit: MB
                        group_id: "493768343925293227"
                        group_name: DSL
                      datas:
                        - labels: {}
                          times:
                            - 1704338561588
                          values:
                            - 1775802
                      step: ""
                      is_variable: false
                      is_calendar: true
                      status_code: 200
                    - status_code: 404
                      error_code: Uniquery.MetricModel.MetricModelNotFound
                      description: The Metric Model Does Not Exist
                      solution: Please check whether the parameter is correct.
                      error_link: None
                      error_details: ""
                exp2:
                  value:
                    - status_code: 404
                      error_code: Uniquery.MetricModel.MetricModelNotFound
                      description: The Metric Model Does Not Exist
                      solution: Please check whether the parameter is correct.
                      error_link: None
                      error_details: ""
                    - status_code: 404
                      error_code: Uniquery.MetricModel.MetricModelNotFound
                      description: The Metric Model Does Not Exist
                      solution: Please check whether the parameter is correct.
                      error_link: None
                      error_details: ""
        "404":
          content:
            application/json:
              examples:
                exp1:
                  value:
                    error_code: Uniquery.MetricModel.MetricModelNotFound
                    description: The Metric Model Does Not Exist
                    solution: Please check whether the parameter is correct.
                    error_link: None
                    error_details: ""
      summary: "metric-model-groups/{group_name}/metric-models"
      description: 根据分组名称和指标模型名称查询指标数据(以数组形式接受请求体参数)
    parameters:
      - name: group_name
        description: 分组名称
        schema:
          type: string
        in: path
        required: true
      - name: ignoring_store_cache
        description: 是否查询持久化缓存下来的数据。默认为 false，不忽略
        schema:
          type: boolean
        in: query
      - name: include_model
        description: 是否返回指标模型信息。默认为false
        schema: {}
        in: query
      - name: ignoring_memory_cache
        description: 是否忽略内存缓存数据，默认为false，不忽略
        schema:
          type: boolean
        in: query
      - name: ignoring_hcts
        description: 是否忽略高基查询。默认为false，不忽略
        schema:
          type: boolean
        in: query
      - name: filter_mode
        description: 过滤模式。默认为normal
        schema:
          enum:
            - normal
            - error
            - ignore
          type: string
        in: query
      - name: fill_null
        description: 是否补空，默认为true，即补null
        schema:
          type: boolean
        in: query
  /api/mdl-uniquery/v1/metric-models/{id}/fields:
    summary: 基于指标模型id获取字段列表
    get:
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
              examples:
                字段列表:
                  value:
                    - field_1
                    - field_2
          description: ok
      summary: 基于指标模型id获取字段列表
    parameters:
      - name: id
        description: 指标模型id
        schema:
          type: string
        in: path
        required: true
  /api/mdl-uniquery/v1/metric-models/{id}/field_values/{field_name}:
    summary: 基于指标模型id获取字段的值列表
    get:
      parameters:
        - name: id
          description: 指标模型id
          schema:
            type: string
          in: path
          required: true
        - name: field_name
          description: 字段名称
          schema:
            type: string
          in: path
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FieldValues"
              examples:
                字段列表:
                  value:
                    type: keyword
                    values:
                      - v1
                      - v2
                      - v3
          description: ok
      summary: 基于指标模型id获取字段的值列表
  /api/mdl-uniquery/v1/metric-models/{id}/labels:
    summary: 基于指标模型id获取维度字段列表
    get:
      parameters:
        - name: id
          in: path
          required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
              examples:
                指标结果维度字段:
                  value:
                    - labels_1
                    - labels_2
          description: ok
      summary: 基于指标模型id获取维度字段列表
components:
  schemas:
    errorCode:
      description: 错误信息返回格式
      required:
        - error
        - status
      type: object
      properties:
        error:
          description: 错误体
          required:
            - type
            - reason
          type: object
          properties:
            root_cause:
              description: 根错误信息
              type: array
              items:
                type: object
            type:
              description: 错误类型
              minLength: 1
              type: string
            reason:
              description: 原因
              minLength: 1
              type: string
            failed_shards:
              description: 失败的分片及其原因
              type: array
              items:
                type: object
            caused_by:
              description: 详细的错误信息
              type: object
        status:
          description: 状态码
          type: number
      x-examples:
        example-1:
          error:
            root_cause: []
            type: x_content_parse_exception
            reason: "[1:438] [bool] failed to parse field [must]"
            failed_shareds: []
            caused_by: {}
          status: 400
    promqlErrorCode:
      title: Root Type for promqlErrorCode
      description: promql 错误信息返回格式
      required:
        - error
        - errorType
        - status
      type: object
      properties:
        status:
          description: 状态
          type: string
          example: error
        errorType:
          description: 错误类型
          type: string
          example: timeout
        error:
          description: 错误体
          type: string
          example: query timed out in expression evaluation
      example:
        status: error
        errorType: timeout
        error: query timed out in expression evaluation
    UniqueryErrorCode:
      description: ""
      required:
        - description
        - error_code
        - error_detail
        - error_link
        - solution
      type: object
      properties:
        description:
          description: 错误描述
          type: string
        error_code:
          description: 错误码
          type: string
        error_detail:
          description: 错误详情
          type: string
        error_link:
          description: 错误链接
          type: string
        solution:
          description: 处理建议
          type: string
      example:
        description: some text
        error_code: some text
        error_detail: some text
        error_link: some text
        solution: some text
    SpanDetail:
      description: span原始数据
      required:
        - Name
        - SpanContext.TraceID
        - SpanContext.SpanID
        - SpanContext.TraceFlags
        - SpanContext.TraceState
        - Parent.TraceID
        - Parent.SpanID
        - Parent.TraceFlags
        - Parent.TraceState
        - SpanKind
        - StartTime
        - EndTime
        - "@timestamp"
        - Duration
        - Attributes
        - Events
        - Links
        - Status.Code
        - Status.Description
        - Resource
        - Status.CodeDesc
        - SpanKindDesc
      type: object
      properties:
        Name:
          description: span名称
          type: string
        SpanContext.TraceID:
          description: trace id
          type: string
        SpanContext.SpanID:
          description: span id
          type: string
        SpanContext.TraceFlags:
          description: W3C Trace Flags
          type: string
        SpanContext.TraceState:
          description: "系统特定的配置数据, 键值对列表"
          type: map
        Parent.TraceID:
          description: 父trace id
          type: string
        Parent.SpanID:
          description: 父span id
          type: string
        Parent.TraceFlags:
          description: W3C Trace Flags
          type: string
        Parent.TraceState:
          description: "系统特定的配置数据, 键值对列表"
          type: map
        SpanKind:
          description: 描述在一次追踪中Span及其父子之间的关系
          type: integer
        SpanKindDesc:
          description: 对SpanKind字段的翻译
          type: string
        StartTime:
          description: "开始时间, Unix纳秒时间戳"
          type: integer
        EndTime:
          description: "结束时间, Unix纳秒时间戳"
          type: integer
        "@timestamp":
          description: opensearch时间戳
          type: string
        Duration:
          description: "耗时, 单位为纳秒"
          type: integer
        Attributes:
          description: 业务属性
          type: map
        Events:
          description: 结构化日志消息
          type: array
        Links:
          description: 关联链路
          type: array
        Status.Code:
          description: "span状态, 值为0,1,2"
          type: int
        Status.CodeDesc:
          description:
            "对Status.Code字段的翻译, Status.Code=0对应Unset, Status.Code=1对应Error,\
            \ Status.Code=2对应Ok"
          type: string
        Status.Description:
          description: 状态描述
          type: string
        Resource:
          description: 系统进程属性
          type: map
    TraceDetail:
      description: 单条trace详情
      required:
        - trace_id
        - trace_status
        - start_time
        - end_time
        - duration
        - span_stats
        - spans
        - services
      type: object
      properties:
        trace_id:
          description: trace id
          type: string
        trace_status:
          description: "trace状态, 值为ok或error"
          type: string
        start_time:
          description: "整条trace的开始时间, Unix纳秒时间戳"
          type: integer
        end_time:
          description: "整条trace的结束时间, Unix纳秒时间戳"
          type: integer
        duration:
          description: "整条链路的耗时, 单位是纳秒"
          type: integer
        spans:
          description: span原始数据组成的集合
          type: array
        services:
          description: trace涉及到服务信息统计
          type: array
        span_stats:
          description: "span状态统计, 包括Ok, Error, Unset三种状态"
          type: map
    Error:
      description: ""
      required:
        - description
        - error_code
        - error_detail
        - error_link
        - solution
      type: object
      properties:
        description:
          description: 错误描述
          type: string
        error_code:
          description: 错误码
          type: string
        error_detail:
          description: 错误详情
          type: string
        error_link:
          description: 错误链接
          type: string
        solution:
          description: 处理建议
          type: string
      example:
        description: some text
        error_code: some text
        error_detail: some text
        error_link: some text
        solution: some text
    Filter:
      description: 过滤条件
      required:
        - name
        - value
        - operation
      type: object
      properties:
        name:
          description: 过滤字段名称
          type: string
        value:
          description:
            "过滤的值。当 operation 是 in 时，value 为任意基本类型的数组，且长度大于等于1；当 operation\
            \ 是 = 或 != 时，value 为任意基本类型的值；当 operation 是 range 时，value 是个由范围的下边界和上边界\
            组成的长度为 2 的数值型数组。当 operation 是 out_range 时, value 是一个长度为 2 的数组，对应过滤条件时是\
            \ 字段 < value[0] || 字段 >= value[1]"
          type: array
          items: {}
        operation:
          description: 操作符。
          enum:
            - in
            - "="
            - "!="
            - range
            - out_range
            - like
            - not_like
            - ">"
            - ">="
            - <
            - <=
          type: string
    MetricResults:
      description: 基于指标模型的指标查询结果
      required:
        - datas
        - step
        - is_variable
      type: object
      properties:
        model:
          $ref: "#/components/schemas/MetricModel"
          description: 指标模型基本信息。当include_model为true时，返回模型详细信息；当include_model为false时，不返回此字段。
        datas:
          description: 指标数据
          type: array
          items:
            $ref: "#/components/schemas/MetricData"
        step:
          description:
            范围查询时当前指标模型计算公式执行的步长。主要是为了兼容dsl中的日期直方图的 fixed_interval 是常量时，前端仪表盘画图使用。当查询语言是
            promql 时，该值为请求的 step；当查询语言是 dsl 且日期直方图中使用了变量时，该值为请求的 step；当查询语言是 dsl 且日期直方图中使用了常量，该值为日期直方图中的常量。
          type: string
        is_variable:
          description: dsl 原子指标的指标模型中的计算公式是否使用了变量。默认是 false
          type: string
      example:
        model:
          id: 71
          name: some text
          measure_name: some text
          metric_type: atomic
          data_view_id: some text
          data_view_name: some text
          query_type: dsl
          formula: some text
          date_field: some text
          date_format: epoch_millis
          measure_field: some text
          unit_type: percent
          unit: KB
          tags:
            - some text
            - some text
          custom_attribute: {}
          comment: some text
          update_time: some text
          group_id: 91
          group_name: some text
          is_calendar_interval: 38
          task:
            id: 69
            type: fixed
            name: some text
            model_id: 60
            schedule:
              type: FIX_RATE
              expression: some text
            time_windows:
              - some text
              - some text
            steps:
              - some text
              - some text
            plan_times:
              - 91
              - 13
            index_base_name: some text
            index_base: some text
            retrace_duration: some text
            comment: some text
            task_schedule_id: 22
            schedule_status: 39
            schedule_sync_status: 93
            execute_status: 36
            update_time: some text
            measure_name: some text
        datas:
          - times:
              - {}
              - {}
            values:
              - 36.4
              - 87.75
          - times:
              - {}
              - {}
            values:
              - 6.66
              - 81.74
        step: some text
        is_variable: some text
    MetricResultsSimulate:
      description: 基于指标模型的指标查询结果
      required:
        - datas
        - step
        - is_variable
      type: object
      properties:
        datas:
          description: 指标数据
          type: array
          items:
            $ref: "#/components/schemas/MetricData"
        step:
          description:
            范围查询时当前指标模型计算公式执行的步长。主要是为了兼容dsl中的日期直方图的 fixed_interval 是常量时，前端仪表盘画图使用。当查询语言是
            promql 时，该值为请求的 step；当查询语言是 dsl 且日期直方图中使用了变量时，该值为请求的 step；当查询语言是 dsl 且日期直方图中使用了常量，该值为日期直方图中的常量。
          type: string
        is_variable:
          description: dsl 原子指标的指标模型中的计算公式是否使用了变量。默认是 false
          type: string
      example:
        model:
          name: some text
          metric_type: complex
          data_view_name: some text
          query_type: promql
          formula: some text
          date_field: some text
          date_format: epoch_second
          metric_field: some text
          unit_type: timeUnit
          unit: bit
          group_id: 1111
          group_name: 系统CPU监控
        datas:
          - labels:
              cpu: "1"
              instance: 10.4.68.120:9101
            times:
              - 1669789800
              - 1669789900
            values:
              - 10
              - 11
          - labels:
              cpu: "2"
              instance: 10.4.68.120:9101
            times:
              - 1669789800
              - 1669789900
            values:
              - 10
              - 11
    MetricModelSimulate:
      description: 指标模型信息
      required:
        - data_view_name
        - date_field
        - date_format
        - formula
        - measure_field
        - name
        - unit
        - unit_type
        - metric_type
        - query_type
        - id
      type: object
      properties:
        id:
          description: 指标模型 id
          type: string
        name:
          description: 指标模型名称
          type: string
        metric_type:
          description: 指标类型
          enum:
            - atomic
            - complex
          type: string
        data_view_name:
          description: 数据视图名称
          type: string
        query_type:
          description: 查询语言
          enum:
            - promql
          type: string
        formula:
          description: 计算公式
          type: string
        date_field:
          description: 时间字段。当查询语言是 promql 时，此字段值为 @timestamp。
          type: string
        date_format:
          description: 时间格式。当查询语言是 promql 时，此字段值为 epoch_millis。
          enum:
            - epoch_millis
          type: string
        unit_type:
          description: 单位类型
          enum:
            - numUnit
            - storeUnit
            - percent
            - transmissionRate
            - timeUnit
          type: string
        unit:
          description: 度量单位
          enum:
            - none
            - K
            - Mil
            - Bil
            - Tri
            - bit
            - Byte
            - KB
            - MB
            - GB
            - TB
            - PB
            - "%"
            - bps
            - Kbps
            - Mbps
            - μs
            - ms
            - s
            - m
            - h
            - day
            - week
            - month
            - year
          type: string
        measure_field:
          description: 度量字段。当查询语言是 promql 时，此字段值为 value。
          type: string
      example:
        name: some text
        data_view_name: some text
        formula: some text
        date_field: some text
        date_format: epoch_second
        metric_field: some text
        unit_type: storeUnit
        unit: bit
    Task:
      description: 持久化任务
      required:
        - model_id
        - name
        - schedule
        - index_base_name
        - comment
        - id
        - retrace_duration
        - schedule_status
        - schedule_sync_status
        - task_schedule_id
        - index_base_type
        - index_base
        - update_time
        - plan_time
        - measure_name
        - plan_times
        - step
        - time_windows
        - execute_status
        - steps
        - type
      type: object
      properties:
        id:
          description: 持久化任务id
          type: string
        type:
          description: 任务类型。分为日历步长持久化任务（calendar）和固定步长持久化任务（fixed）两种。
          enum:
            - calendar
            - fixed
          type: string
        name:
          description: 持久化任务名称
          type: string
        model_id:
          description: 指标模型 ID
          type: string
        schedule:
          $ref: "#/components/schemas/Schedule"
          description: 执行频率
        time_windows:
          description:
            "时间窗口。只有在查询语言是DSL时,才有值，promql时为空。time_window=< time_durations\
            \ >，用一个数字，后面跟时间单位来定义。时间单位可以是如下之一：m - 分钟； h - 小时； d - 天；还支持使用 前1小时(previous_hour)、\
            前1天(previous_day)、前一周(previous_week)、前一个月(previous_month)"
          type: array
          items:
            type: string
        steps:
          description:
            "持久化步长，支持配置多个步长。step=< time_durations >，用一个数字，后面跟时间单位来定义。时间\
            单位可以是如下之一： m - 分钟； h - 小时； d - 天； w - 周； y - 年；可选步长为 5m, 10m, 15m, 20m,\
            \ 30m, 1h, 2h, 3h, 6h, 12h, 1d。"
          type: array
          items:
            type: string
        plan_times:
          description: "计划时间,与时间窗口对应，用于保证数据查询的连续性"
          type: array
          items:
            format: int64
            type: integer
        index_base_name:
          description: 索引库名称
          type: string
        index_base:
          description: 索引库类型
          type: string
        retrace_duration:
          description:
            追溯时长。新建任务时按追溯时长追溯数据。追溯时长最小单位为小时，追溯上限30天。retrace_duration=<
            time_durations >，用一个数字，后面跟时间单位来定义。时间单位可以是如下之一： h - 小时； d - 天；
          type: string
        comment:
          description: 任务说明
          type: string
        task_schedule_id:
          description: xxl_job 调度的任务id
          type: integer
        schedule_status:
          description: xxl_job 任务的最新状态
          type: integer
        schedule_sync_status:
          description: xxl_job 任务的同步状态
          enum: []
          type: integer
        execute_status:
          description: "任务执行状态。4: 执行成功；5: 执行失败"
          type: integer
        update_time:
          description: 更新时间
          pattern: yyyy-MM-dd hh:mm:ss
          type: integer
        measure_name:
          description: 度量名称
          type: string
    Schedule:
      description: 执行频率配置项
      required:
        - time_type
        - frequency
        - expression
        - type
      type: object
      properties:
        type:
          description: 执行类型。枚举，支持配置固定频率(FIX_RATE)和配置crontab表达式（CRON）
          enum:
            - FIX_RATE
            - CRON
          type: string
        expression:
          description: |-
            执行表达式。

            1.固定频率指以固定周期执行持久化，frequency=< time_durations >，用一个数字，后面跟时间单位来定义。时间单位可以是如下之一：m - 分钟； h - 小时； d - 天
          type: string
    FieldValues:
      description: 字段值列表
      required:
        - type
        - values
      type: object
      properties:
        type:
          description: 数据类型
          type: string
        values:
          description: 字段值列表
          type: array
          items:
            type: string
    FormulaConfig:
      description: 计算公式配置
      type: object
      properties:
        condition:
          $ref: "#/components/schemas/Condition"
          description: 数据过滤
        condition_str:
          description: 对应code模式下的过滤条件
          type: string
        aggr_expression:
          $ref: "#/components/schemas/AggrExpression"
          description: 度量聚合计算
        aggr_expression_str:
          description: 对应code模式下的度量聚合计算
          type: string
        group_by_fields:
          description: 分组字段.（vega技术名称）
          type: array
          items:
            type: string
    Condition:
      description: 数据过滤
      required:
        - operation
      type: object
      properties:
        field:
          description: 字段名称
          type: string
        operation:
          description: 操作符
          enum:
            - and
            - or
            - ==
            - "!="
            - ">"
            - ">="
            - <
            - <=
            - in
            - not_in
            - like
            - not_like
            - contain
            - not_contain
            - range
            - out_range
            - exist
            - not_exist
            - regex
            - match
            - match_phrase
          type: string
        sub_conditions:
          description: 子过滤条件
          type: array
          items:
            $ref: "#/components/schemas/Condition"
        value:
          description: 字段值
        value_from:
          description: 字段值来源，当前仅支持 "const"
          enum:
            - const
            - field
            - user
          type: string
    AggrExpression:
      description: 度量聚合计算
      required:
        - field
        - aggr
      type: object
      properties:
        field:
          description: 聚合字段
          type: string
        aggr:
          description: 聚合方式
          enum:
            - count_distinct
            - sum
            - max
            - min
            - avg
            - count
          type: string
    Metrics:
      description: 同环比、占比分析
      required:
        - type
      type: object
      properties:
        type:
          description: 同环比占比类型。同环比：sameperiod；占比：proportion
          enum:
            - sameperiod
            - proportion
          type: string
        sameperiod_config:
          $ref: "#/components/schemas/SameperiodConfig"
          description: 同环比配置
    SameperiodConfig:
      description: 同环比配置
      required:
        - method
        - offset
        - time_granularity
      type: object
      properties:
        method:
          description: 计算方法，增长值或增长率
          enum:
            - growth_value
            - growth_rate
          type: string
        offset:
          description: 偏移量
          type: integer
        time_granularity:
          description: 时间粒度
          enum:
            - day
            - month
            - quarter
            - year
          type: string
    ReqDataSource:
      description: 数据来源
      required:
        - type
        - id
      type: object
      properties:
        type:
          description: "类型。机器数据湖的数据源类型为 data_view, vega的数据源类型为 vega_logic_view。"
          enum:
            - data_view
            - vega_logic_view
          type: string
        id:
          description: 数据来源id
          type: string
    DataSource:
      description: 数据来源
      required:
        - type
        - name
        - id
      type: object
      properties:
        type:
          description: 数据来源类型
          type: string
        id:
          description: 数据来源id
          type: string
        name:
          description: 数据来源名称
          type: string
    MetricModel:
      description: 指标模型基本信息。当include_model为true时，返回模型详细信息；当include_model为false时，不返回此字段。
      required:
        - date_field
        - date_format
        - measure_field
        - name
        - unit
        - unit_type
        - metric_type
        - query_type
        - id
        - group_id
        - group_name
        - comment
        - is_calendar_interval
        - measure_name
        - tags
        - task
        - update_time
        - data_source
      type: object
      properties:
        id:
          description: 指标模型 id
          type: string
        name:
          description: 指标模型名称
          type: string
        measure_name:
          description: 度量名称
          type: string
        data_source:
          $ref: "#/components/schemas/DataSource"
          description: 数据来源
        metric_type:
          description: 指标类型，分原子指标和复合指标。
          enum:
            - atomic
            - complex
          type: string
        query_type:
          description: 指标查询语言。根据 category 和 datasource 来展示指标查询语言列表。
          enum:
            - promql
            - dsl
            - sql
          type: string
        formula:
          description: 计算公式
          type: string
        formula_config:
          $ref: "#/components/schemas/FormulaConfig"
          description: 配置化计算公式
        analysis_dimessions:
          description: 分析维度。即在指标查询时可指定的下钻维度集合
          type: array
          items:
            type: string
        date_field:
          description: 时间字段。当查询语言是sql时，必须指定时间字段。字段列表从数据源中获取。
          type: string
        date_format:
          description:
            时间格式。当查询语言是 promql 时，此字段值为 epoch_millis。当查询语言是 dsl 时，此字段值为
            epoch_millis
          enum:
            - epoch_millis
          type: string
        measure_field:
          description: 度量字段。当查询语言是 promql 时，此字段值为 value。当查询语言是 dsl 时，此字段值为 dsl 语句中的值聚合名称。
          type: string
        unit_type:
          description: 单位类型
          enum:
            - numUnit
            - storeUnit
            - percent
            - transmissionRate
            - timeUnit
          type: string
        unit:
          description: 度量单位
          enum:
            - none
            - K
            - Mil
            - Bil
            - Tri
            - bit
            - Byte
            - KB
            - MB
            - GB
            - TB
            - PB
            - "%"
            - bps
            - Kbps
            - Mbps
            - μs
            - ms
            - s
            - m
            - h
            - day
            - week
            - month
            - year
          type: string
        tags:
          description: 标签（可以为空）
          type: array
          items:
            type: string
        comment:
          description: 指标模型备注（可以为空）
          type: string
        update_time:
          description: 更新时间
          type: integer
        group_id:
          description: 分组ID
          type: string
        group_name:
          description: 分组名称，对于默认分组，查询返回结果为空字符串，由前端根据语言环境进行展示
          type: string
        is_calendar_interval:
          description: "是否日历间隔。0: 非日历间隔； 1: 日历间隔。查询简单信息时无此字段"
          type: integer
        task:
          $ref: "#/components/schemas/Task"
          description: 持久化任务
      example:
        name: some text
        data_view_name: some text
        formula: some text
        date_field: some text
        date_format: epoch_second
        metric_field: some text
        unit_type: storeUnit
        unit: bit
    MetricData:
      description: 指标数据计算结果
      required:
        - labels
        - times
        - values
      type: object
      properties:
        labels:
          description: 普通维度 label 的 map，key 为字段名，value 为字段值，键值的类型都是 string
          type: map
        times:
          description: 时间值数组。为字符串或者数值类型
          type: array
          items:
            type: object
        values:
          description: 度量值数组。数值类型
          type: array
          items:
            type: number
        growth_values:
          description: 增长值。当请求了同环比分析时才有此字段。
          type: array
          items:
            type: number
        growth_rates:
          description: 增长率。当请求了同环比分析时才有此字段。
          type: array
          items:
            type: number
        proportions:
          description: 占比。当请求了占比分析时才有此字段。
          type: array
          items:
            type: number
    ReqMetricModel:
      description: 基于指标模型的指标数据查询请求体
      required:
        - start
        - end
      type: object
      properties:
        instant:
          description:
            是否是即时查询。可选，默认为 false。当 instant = true 时，表示即时查询；当 instant =
            false 时，表示范围查询。
          type: boolean
        start:
          format: int64
          description: "指标查询的开始时间。 start=< unix_timestamp >，单位到毫秒。 例如: 1646360670123"
          type: integer
        end:
          format: int64
          description: "指标查询的结束时间。end=< unix_timestamp >，单位到毫秒。例如: 1646471470123"
          type: integer
        step:
          description:
            范围查询的步长。当 instant 为 false 时，必须。step=< time_durations >，用一个数字，后面跟时间单位来定义。若不填单位，则默认按秒计算。时间单位可以是如下之一：
            ms - 毫秒； s - 秒； m - 分钟； h - 小时； d - 天； w - 周； y - 年；
          type: string
        filters:
          description: 过滤条件数组。可为空。当存在过滤条件时，过滤条件对象的字段都是必须的。
          type: array
          items:
            $ref: "#/components/schemas/Filter"
        analysis_dimensions:
          description: 分析维度。即在指标查询时可指定的下钻维度集合
          type: array
          items:
            type: string
        order_by_fields:
          description: 排序字段。即在指标查询时可指定的排序字段集合
          type: array
          items:
            $ref: "#/components/schemas/OrderField"
        having_condition:
          $ref: "#/components/schemas/HavingCondition"
          description: having值过滤。即在指标查询时可指定的值过滤的过滤条件
        metrics:
          $ref: "#/components/schemas/Metrics"
          description: 同环比、占比分析
    ReqMetricModelSimulate:
      description: 基于指标模型的指标数据预览
      required:
        - metric_type
        - query_type
        - formula
        - data_view_name
        - data_source
        - start
        - end
      type: object
      properties:
        data_source:
          $ref: "#/components/schemas/ReqDataSource"
          description: 数据来源
        metric_type:
          description: 指标类型，分原子指标和复合指标
          enum:
            - atomic
            - complex
          type: string
        query_type:
          description: 指标查询语言。
          enum:
            - promql
            - dsl
            - sql
          type: string
        formula:
          description: 计算公式
          type: string
        formula_config:
          $ref: "#/components/schemas/FormulaConfig"
          description: 配置化计算公式
        date_field:
          description: 时间字段。当查询语言是sql时，必须指定时间字段。字段列表从数据源中获取。
          type: string
        measure_field:
          description: 度量字段。当查询语言是 promql 时，此字段不需要传。当查询语言是 dsl 时，此字段是必须的。
          type: string
        instant:
          description:
            是否是即时查询。可选，默认为 false。当 instant = true 时，表示即时查询；当 instant =
            false 时，表示范围查询。
          type: boolean
        start:
          format: int64
          description: "指标查询的开始时间。 start=< unix_timestamp >，单位到毫秒。 例如: 164636067012"
          type: integer
        end:
          format: int64
          description: "指标查询的结束时间。end=< unix_timestamp >，单位到毫秒。例如: 1646471470123"
          type: integer
        step:
          description:
            范围查询的步长。当 instant 为 false 时，必须。step=< time_durations >，用一个数字，后面跟时间单位来定义。若不填单位，则默认按秒计算。时间单位可以是如下之一：
            ms - 毫秒； s - 秒； m - 分钟； h - 小时； d - 天； w - 周； y - 年；
          type: string
        analysis_dimensions:
          description: 分析维度。即在指标查询时可指定的下钻维度集合
          type: array
          items:
            type: string
        order_by_fields:
          description: 排序字段。即在指标查询时可指定的排序字段集合
          type: array
          items:
            $ref: "#/components/schemas/OrderField"
        having_condition:
          $ref: "#/components/schemas/HavingCondition"
          description: having值过滤。即在指标查询时可指定的值过滤的过滤条件
        metrics:
          $ref: "#/components/schemas/Metrics"
          description: 同环比、占比分析
        is_model_request:
          description: 是否来自模型的请求
          type: boolean
      example:
        method: GET
        metric_type: 原子指标
        data_view_id: qwrerer56567787
        query_type: promql
        formula:
          "avg(irate(node_cpu_seconds_total{name=~\"node-14-35\",mode=\"system\"\
          }[5m]))by(name)"
    ReqMetricModelForGroup:
      description: 基于指标模型的指标数据查询请求体
      required:
        - model_name
      type: object
      properties:
        instant:
          description:
            是否是即时查询。可选，默认为 false。当 instant = true 时，表示即时查询；当 instant =
            false 时，表示范围查询。
          type: boolean
        start:
          format: int64
          description: "指标查询的开始时间。 start=< unix_timestamp >，单位到毫秒。 例如: 1646360670123"
          type: integer
        end:
          format: int64
          description: "指标查询的结束时间。end=< unix_timestamp >，单位到毫秒。例如: 1646471470123"
          type: integer
        step:
          description:
            范围查询的步长。当 instant 为 false 时，必须。step=< time_durations >，用一个数字，后面跟时间单位来定义。若不填单位，则默认按秒计算。时间单位可以是如下之一：
            ms - 毫秒； s - 秒； m - 分钟； h - 小时； d - 天； w - 周； y - 年；
          type: string
        filters:
          description: 过滤条件数组。可为空。当存在过滤条件时，过滤条件对象的字段都是必须的。
          type: array
          items:
            $ref: "#/components/schemas/Filter"
        model_name:
          description: 指标模型名称
          type: string
        analysis_dimessions:
          description: 分析维度。即在指标查询时可指定的下钻维度集合
          type: array
          items:
            type: string
        order_by_fields:
          description: 排序字段。即在指标查询时可指定的排序字段集合
          type: array
          items:
            $ref: "#/components/schemas/OrderField"
        having_condition:
          $ref: "#/components/schemas/HavingCondition"
          description: having值过滤。即在指标查询时可指定的值过滤的过滤条件
        metrics:
          $ref: "#/components/schemas/Metrics"
          description: 同环比、占比分析
    OrderField:
      description: 排序字段
      required:
        - name
        - type
        - direction
      type: object
      properties:
        name:
          description: 字段名
          type: string
        direction:
          description: 排序方向
          enum:
            - asc
            - desc
          type: string
    HavingCondition:
      description: having值数据过滤
      required:
        - operation
        - value
        - field
      type: object
      properties:
        field:
          description: 字段名称。只有 __value
          enum:
            - __value
          type: string
        operation:
          description: 操作符
          enum:
            - ==
            - "!="
            - ">"
            - ">="
            - <
            - <=
            - in
            - not_in
            - range
            - out_range
          type: string
        value:
          description: 字段值
  responses:
    "400BadRequest":
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            exp:
              value:
                description: Invalid Parameter
                error_code: DataModel.MetricModel.InvalidParameter
                error_detail: some text
                error_link: some text
                solution: some text
      description: 参数错误
    "500InternalError":
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          examples:
            exp:
              value:
                description: internel server error
                error_code: DataModel.MetricModel.InternalError
                error_detail: some text
                error_link: some text
                solution: some text
      description: 内部错误
