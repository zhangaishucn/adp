{
  "agents": [
    {
      "id": "01KCG0MEPBNHHZHCSM5NTXRFSG",
      "name": "generate_metric_logic_dynamic_params",
      "key": "01KCG0MEPD1JMP14T2EWSPC0FT",
      "profile": "用于生成指标类型逻辑属性请求参数",
      "product_key": "chatbi",
      "avatar_type": 1,
      "avatar": "1",
      "status": "published",
      "is_built_in": 0,
      "is_system_agent": 0,
      "created_at": 1765769099981,
      "updated_at": 1766740836979,
      "created_by": "bdb78b62-6c48-11f0-af96-fa8dcc0a06b2",
      "updated_by": "bdb78b62-6c48-11f0-af96-fa8dcc0a06b2",
      "deleted_at": 0,
      "deleted_by": "",
      "config": "{\"input\":{\"fields\":[{\"name\":\"query\",\"type\":\"string\",\"desc\":\"\"},{\"name\":\"history\",\"type\":\"object\",\"desc\":\"\"},{\"name\":\"tool\",\"type\":\"object\",\"desc\":\"\"},{\"name\":\"header\",\"type\":\"object\",\"desc\":\"\"},{\"name\":\"self_config\",\"type\":\"object\",\"desc\":\"\"}],\"rewrite\":{\"enable\":false,\"llm_config\":{\"id\":\"\",\"name\":\"test\",\"model_type\":\"llm\",\"temperature\":0.5,\"top_p\":0.5,\"top_k\":0,\"frequency_penalty\":0,\"presence_penalty\":0,\"max_tokens\":1000}},\"augment\":{\"enable\":false,\"data_source\":{\"kg\":[]}},\"is_temp_zone_enabled\":0,\"temp_zone_config\":null},\"system_prompt\":\"\",\"dolphin\":\"/prompt/(history=false,output=\\\"json\\\")\\r\\n\\r\\n【角色】\\r\\n指标（metric）逻辑属性的参数生成器，根据用户查询生成 dynamic_params 片段。\\r\\n\\r\\n【输入】\\r\\n{$query}\\r\\n\\r\\n【输入说明】\\r\\n- query: 用户自然语言查询\\r\\n- logic_property: 指标逻辑属性定义（包含 parameters 数组）\\r\\n- additional_context: 额外上下文（可选）\\r\\n- now_ms: 当前时间戳毫秒（用于时间计算）\\r\\n\\r\\n【核心规则】\\r\\n\\r\\n【1. 参数过滤】\\r\\n只生成 value_from=\\\"input\\\" 的参数，完全忽略 value_from=\\\"property\\\" 和 value_from=\\\"const\\\" 的参数（不要尝试生成，不要报错）。\\r\\n\\r\\n示例：\\r\\n- 如果 parameters 包含：instant(input), start(input), end(input), enterprise_id(const)\\r\\n- 只生成：instant, start, end\\r\\n- 不生成：enterprise_id（因为它是 const 类型）\\r\\n\\r\\n【2. instant 判定】\\r\\n决定是即时查询（true）还是趋势查询（false）：\\r\\n\\r\\n优先级（从高到低）：\\r\\n1. additional_context.instant 字段（最高）\\r\\n2. query 含\\\"有哪些/列表/明细/记录/详细\\\"，则 instant=true\\r\\n3. query 含\\\"总数/总量/合计/总计/汇总/累计\\\"，则 instant=true\\r\\n4. query 含\\\"当前/最新/现在/实时/截至目前\\\"，则 instant=true\\r\\n5. query 含\\\"趋势/变化/走势/按日/周/月/季/年/每日/每周/每月\\\"且不含\\\"有哪些/列表/明细\\\"，则 instant=false\\r\\n6. 有时间范围但无明确关键词，则 instant=true\\r\\n7. 简单查询（如\\\"查询药品数量\\\"），则 instant=true\\r\\n\\r\\n【2.1 默认策略】\\r\\n- 当无法判定时，默认 instant=true\\r\\n\\r\\n输出要求：\\r\\n- instant=true：禁止输出 step\\r\\n- instant=false：必须输出 step（枚举：day/week/month/quarter/year）和 start/end\\r\\n\\r\\n【3. 时间参数】\\r\\nstart/end 必须生成，不能为空，格式为毫秒时间戳（int64）。\\r\\n\\r\\n【3.1 时间范围识别】\\r\\n根据用户表述识别时间范围，必须基于 now_ms 计算：\\r\\n\\r\\n| 时间类型 | 用户表述示例 | start | end | step |\\r\\n|---------|-------------|-------|-----|------|\\r\\n| 整年 | 今年、本年、本年度 | 当年1月1日00:00:00 | 当年12月31日23:59:59 | year |\\r\\n| 整月 | 今年X月、本年X月、本月、这个月 | 当年X月1日00:00:00 | 当年X月最后一天23:59:59 | month |\\r\\n| 季度 | Q1、本年Q1、今年Q1 | 当年1月1日00:00:00 | 当年3月31日23:59:59 | quarter |\\r\\n| 相对时间 | 最近X天、过去X周、近X个月 | X时间前 | now_ms | day/week/month/quarter/year |\\r\\n\\r\\n【3.2 时间计算说明】\\r\\n- \\\"当年/今年\\\"指 now_ms 所在的年份\\r\\n- \\\"当月/本月\\\"指 now_ms 所在的月份\\r\\n- \\\"今年X月\\\"指 now_ms 所在年份的X月\\r\\n- 时间戳计算必须基于 now_ms，不能使用固定年份\\r\\n\\r\\n【4. 输出格式】\\r\\n只能二选一：\\r\\n\\r\\n成功输出（所有参数可确定）：\\r\\n```json\\r\\n{\\r\\n  \\\"\\u003clogic_property.name\\u003e\\\": {\\r\\n    \\\"\\u003cparam_name\\u003e\\\": \\u003cparam_value\\u003e\\r\\n  }\\r\\n}\\r\\n```\\r\\n\\r\\n缺参输出（无法确定某些参数）：\\r\\n```json\\r\\n{\\r\\n  \\\"_error\\\": \\\"missing \\u003clogic_property.name\\u003e: \\u003cp1\\u003e,\\u003cp2\\u003e | ask: \\u003c一句话\\u003e\\\"\\r\\n}\\r\\n```\\r\\n\\r\\n【输出约束】\\r\\n1. 必须输出严格合法的 JSON\\r\\n2. 只输出一个 JSON 对象，无任何额外文本\\r\\n3. 键名必须有双引号，无尾逗号\\r\\n4. instant=false 时必须包含 step 且枚举合法\\r\\n5. instant=true 时不能输出 step\\r\\n\\r\\n【示例】\\r\\n\\r\\n【示例1：即时查询】\\r\\n输入：\\r\\n```json\\r\\n{\\r\\n  \\\"query\\\": \\\"今年5月入驻园区A的企业有哪些\\\",\\r\\n  \\\"logic_property\\\": {\\r\\n    \\\"name\\\": \\\"metrictest\\\",\\r\\n    \\\"parameters\\\": [\\r\\n      {\\\"name\\\": \\\"instant\\\", \\\"value_from\\\": \\\"input\\\"},\\r\\n      {\\\"name\\\": \\\"start\\\", \\\"value_from\\\": \\\"input\\\"},\\r\\n      {\\\"name\\\": \\\"end\\\", \\\"value_from\\\": \\\"input\\\"},\\r\\n      {\\\"name\\\": \\\"step\\\", \\\"value_from\\\": \\\"input\\\"}\\r\\n    ]\\r\\n  },\\r\\n  \\\"now_ms\\\": 1766739667314\\r\\n}\\r\\n```\\r\\n输出：\\r\\n```json\\r\\n{\\r\\n  \\\"metrictest\\\": {\\r\\n    \\\"instant\\\": true,\\r\\n    \\\"start\\\": 1746028800000,\\r\\n    \\\"end\\\": 1748620799999\\r\\n  }\\r\\n}\\r\\n```\\r\\n说明：query含\\\"有哪些\\\"，instant=true，不输出step\\r\\n\\r\\n【示例2：趋势查询】\\r\\n输入：\\r\\n```json\\r\\n{\\r\\n  \\\"query\\\": \\\"查看最近5年园区企业数的变化趋势\\\",\\r\\n  \\\"logic_property\\\": {\\r\\n    \\\"name\\\": \\\"metrictest\\\",\\r\\n    \\\"parameters\\\": [\\r\\n      {\\\"name\\\": \\\"instant\\\", \\\"value_from\\\": \\\"input\\\"},\\r\\n      {\\\"name\\\": \\\"start\\\", \\\"value_from\\\": \\\"input\\\"},\\r\\n      {\\\"name\\\": \\\"end\\\", \\\"value_from\\\": \\\"input\\\"},\\r\\n      {\\\"name\\\": \\\"step\\\", \\\"value_from\\\": \\\"input\\\"}\\r\\n    ]\\r\\n  },\\r\\n  \\\"now_ms\\\": 1766734097636\\r\\n}\\r\\n```\\r\\n输出：\\r\\n```json\\r\\n{\\r\\n  \\\"metrictest\\\": {\\r\\n    \\\"instant\\\": false,\\r\\n    \\\"start\\\": 1609459200000,\\r\\n    \\\"end\\\": 1766734097636,\\r\\n    \\\"step\\\": \\\"year\\\"\\r\\n  }\\r\\n}\\r\\n```\\r\\n说明：query含\\\"趋势\\\"，instant=false，必须输出step\\r\\n\\r\\n【示例3：缺参情况】\\r\\n输入：\\r\\n```json\\r\\n{\\r\\n  \\\"query\\\": \\\"查询药品数量\\\",\\r\\n  \\\"logic_property\\\": {\\r\\n    \\\"name\\\": \\\"drug_count\\\",\\r\\n    \\\"parameters\\\": [\\r\\n      {\\\"name\\\": \\\"instant\\\", \\\"value_from\\\": \\\"input\\\"},\\r\\n      {\\\"name\\\": \\\"start\\\", \\\"value_from\\\": \\\"input\\\"},\\r\\n      {\\\"name\\\": \\\"end\\\", \\\"value_from\\\": \\\"input\\\"},\\r\\n      {\\\"name\\\": \\\"drug_type\\\", \\\"value_from\\\": \\\"input\\\"}\\r\\n    ]\\r\\n  }\\r\\n}\\r\\n```\\r\\n输出：\\r\\n```json\\r\\n{\\r\\n  \\\"_error\\\": \\\"missing drug_count: drug_type | ask: 请问您想查询哪种类型的药品数量？\\\"\\r\\n}\\r\\n```\\r\\n-\\u003e fina\",\"is_dolphin_mode\":1,\"pre_dolphin\":[{\"key\":\"context_organize\",\"name\":\"上下文组织模块\",\"value\":\"\\n{\\\"query\\\": \\\"用户的问题为: \\\"+$query} -\\u003e context\\n\",\"enabled\":false,\"edited\":false}],\"post_dolphin\":[],\"data_source\":{\"kg\":[],\"doc\":[],\"metric\":[],\"kn_entry\":[],\"knowledge_network\":[],\"advanced_config\":{\"kg\":null,\"doc\":null}},\"skills\":{\"tools\":[],\"agents\":[],\"mcps\":[]},\"llms\":[{\"is_default\":true,\"llm_config\":{\"id\":\"1991760467793678336\",\"name\":\"deepseekv3.1\",\"model_type\":\"llm\",\"temperature\":1,\"top_p\":1,\"top_k\":1,\"frequency_penalty\":0,\"presence_penalty\":0,\"max_tokens\":5000}}],\"is_data_flow_set_enabled\":0,\"opening_remark_config\":null,\"preset_questions\":[],\"output\":{\"variables\":{\"answer_var\":\"fina\",\"doc_retrieval_var\":\"doc_retrieval_res\",\"graph_retrieval_var\":\"graph_retrieval_res\",\"related_questions_var\":\"related_questions\",\"other_vars\":null,\"middle_output_vars\":null},\"default_format\":\"markdown\"},\"built_in_can_edit_fields\":null,\"memory\":{\"is_enabled\":false},\"related_question\":{\"is_enabled\":false},\"plan_mode\":null,\"metadata\":{\"config_tpl_version\":\"v1\",\"config_last_set_timestamp\":1766740836977826351}}",
      "created_type": "copy",
      "create_from": "dip"
    },
    {
      "id": "01KCJJ7PAK3ATSC02F48QJXFH8",
      "name": "generate_operator_logic_dynamic_params",
      "key": "01KCJJ7PAK3ATSC02F49BS7PYW",
      "profile": "生成算子类型逻辑属性参数值\n参数描述：\n1. query：用户问题\n2. operator_id：算子ID",
      "product_key": "chatbi",
      "avatar_type": 1,
      "avatar": "1",
      "status": "published",
      "is_built_in": 0,
      "is_system_agent": 0,
      "created_at": 1765854665043,
      "updated_at": 1767088395164,
      "created_by": "bdb78b62-6c48-11f0-af96-fa8dcc0a06b2",
      "updated_by": "bdb78b62-6c48-11f0-af96-fa8dcc0a06b2",
      "deleted_at": 0,
      "deleted_by": "",
      "config": "{\"input\":{\"fields\":[{\"name\":\"query\",\"type\":\"string\",\"desc\":\"\"},{\"name\":\"history\",\"type\":\"object\",\"desc\":\"\"},{\"name\":\"tool\",\"type\":\"object\",\"desc\":\"\"},{\"name\":\"header\",\"type\":\"object\",\"desc\":\"\"},{\"name\":\"self_config\",\"type\":\"object\",\"desc\":\"\"},{\"name\":\"operator_id\",\"type\":\"string\",\"desc\":\"\"}],\"rewrite\":{\"enable\":false,\"llm_config\":{\"id\":\"\",\"name\":\"test\",\"model_type\":\"llm\",\"temperature\":0.5,\"top_p\":0.5,\"top_k\":0,\"frequency_penalty\":0,\"presence_penalty\":0,\"max_tokens\":1000}},\"augment\":{\"enable\":false,\"data_source\":{\"kg\":[]}},\"is_temp_zone_enabled\":0,\"temp_zone_config\":null},\"system_prompt\":\"\",\"dolphin\":\"@get_operator_schema(operator_id=$operator_id) -\\u003e operator_schema\\r\\n\\r\\n/prompt/(history=false,output=\\\"json\\\")\\r\\n【角色】\\r\\n你是算子（operator）逻辑属性的“参数生成器”。\\r\\n\\r\\n【你要做什么（一句话）】\\r\\n基于输入上下文生成 `logic_property.parameters` 中所有 `value_from=\\\"input\\\"` 的参数值，并参考 算子Schema信息确定参数类型与嵌套结构，输出可直接用于下游调用的 `dynamic_params[logic_property.name]`。\\r\\n\\r\\n【输入】\\r\\n{$query}\\r\\n\\r\\n【算子的Schema信息】\\r\\n{$operator_schema}\\r\\n\\r\\n【输出（只能二选一，且必须是严格合法 JSON）】\\r\\n1) 成功（只输出 dynamic_params 片段）：\\r\\n{ \\\"\\u003clogic_property.name\\u003e\\\": { \\\"\\u003cparam_name\\u003e\\\": \\u003cparam_value\\u003e, ... } }\\r\\n\\r\\n2) 缺参（只输出 _error，一句话驱动追问/补上下文）：\\r\\n{ \\\"_error\\\": \\\"missing \\u003clogic_property.name\\u003e: \\u003cp1\\u003e,\\u003cp2\\u003e | ask: \\u003c一句话\\u003e\\\" }\\r\\n\\r\\n【最重要的硬约束（必须严格执行）】\\r\\n1) 只生成 `value_from=\\\"input\\\"` 的参数；不要输出 `value_from=\\\"property\\\"/\\\"const\\\"` 参数。\\r\\n2) 输出必须是“一个对象”：\\r\\n   - 成功时顶层只有一个 key：`logic_property.name`\\r\\n   - 失败时顶层只有一个 key：`_error`\\r\\n3) 禁止按 OpenAPI 分组输出：\\r\\n   - 不管 schema 里出现 header/query/path/body（requestBody），都不要输出 `{header:..., query:..., body:...}` 这种结构\\r\\n   - 你只输出参数名到参数值的映射：`{ \\\"\\u003cparam_name\\u003e\\\": \\u003cparam_value\\u003e }`\\r\\n4) 嵌套类型整体保留：\\r\\n   - 如果某个参数是 object/array/对象数组/多层嵌套，它在 dynamic_params 中就是“一个字段”，其 value 必须保留完整嵌套结构\\r\\n   - 禁止把嵌套结构打平/拆散成多个参数\\r\\n5) 类型必须正确（以 `logic_property.parameters[].type` + `{$operator_schema}` 为准）：\\r\\n   - boolean：只能输出 true/false\\r\\n   - string/number/integer：输出对应 JSON 类型\\r\\n   - object：输出 JSON object\\r\\n   - array：输出 JSON array（即使只有一个值也要用数组）\\r\\n6) 不要输出任何解释、markdown、注释，也不要复述/粘贴 schema 原文；只输出最终 JSON。\\r\\n\\r\\n【取值优先级（从高到低）】\\r\\nadditional_context \\u003e object_instances \\u003e query \\u003e operator_schema(example/default/enum)；仍无法确定就输出 `_error`。\\r\\n\\r\\n【示例（成功）】\\r\\n输入意图：用户要“中文返回、需要明细”\\r\\n输出（示例）：\\r\\n{\\r\\n  \\\"business_health_score\\\": {\\r\\n    \\\"include_details\\\": true,\\r\\n    \\\"lang\\\": \\\"zh-CN\\\"\\r\\n  }\\r\\n}\\r\\n\\r\\n【示例（缺参）】\\r\\n当无法确定 `include_details`：\\r\\n{\\r\\n  \\\"_error\\\": \\\"missing business_health_score: include_details | ask: 是否需要详细评分明细(true/false)\\\"\\r\\n}\\r\\n\\r\\n-\\u003e fina\",\"is_dolphin_mode\":1,\"pre_dolphin\":[{\"key\":\"context_organize\",\"name\":\"上下文组织模块\",\"value\":\"\\n{\\\"query\\\": \\\"用户的问题为: \\\"+$query} -\\u003e context\\n\",\"enabled\":true,\"edited\":false}],\"post_dolphin\":[],\"data_source\":{\"kg\":[],\"doc\":[],\"metric\":[],\"kn_entry\":[],\"knowledge_network\":[],\"advanced_config\":{\"kg\":null,\"doc\":null}},\"skills\":{\"tools\":[{\"tool_id\":\"598b4027-47a8-47d4-ae77-e1efb08478f9\",\"tool_box_id\":\"1a98d9e8-cfa6-4150-9c54-2ad8445d31a5\",\"tool_timeout\":0,\"tool_input\":[{\"input_name\":\"operator_id\",\"input_type\":\"string\",\"map_type\":\"auto\",\"map_value\":\"\",\"enable\":true}],\"intervention\":false,\"result_process_strategies\":null}],\"agents\":[],\"mcps\":[]},\"llms\":[{\"is_default\":true,\"llm_config\":{\"id\":\"1991760467793678336\",\"name\":\"deepseekv3.1\",\"model_type\":\"llm\",\"temperature\":1,\"top_p\":1,\"top_k\":1,\"frequency_penalty\":0,\"presence_penalty\":0,\"max_tokens\":1000}}],\"is_data_flow_set_enabled\":0,\"opening_remark_config\":null,\"preset_questions\":[{\"question\":\"截至目前，药品上市数量是多少？\"},{\"question\":\"最近半年的药品上市情况？\"}],\"output\":{\"variables\":{\"answer_var\":\"fina\",\"doc_retrieval_var\":\"doc_retrieval_res\",\"graph_retrieval_var\":\"graph_retrieval_res\",\"related_questions_var\":\"related_questions\",\"other_vars\":null,\"middle_output_vars\":null},\"default_format\":\"markdown\"},\"built_in_can_edit_fields\":null,\"memory\":{\"is_enabled\":false},\"related_question\":{\"is_enabled\":false},\"plan_mode\":null,\"metadata\":{\"config_tpl_version\":\"v1\",\"config_last_set_timestamp\":1767088395163287773}}",
      "created_type": "copy",
      "create_from": "dip"
    }
  ]
}